


<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>robot_designer_plugin.export.collada15.collada &#8212; NRP RobotDesigner 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/hbpdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../../_static/hbpdoc.js"></script>
    <link rel="shortcut icon" href="../../../../_static/hbp_32x32.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
<meta name="viewport" content="width=device-width, initial-scale=1">

  </head>
  <body>
<div class="hbpdoc-page">
    <section class="hbpdoc-title page-header">
        <a class="project-title" href="../../../../index.html">NRP RobotDesigner</a>

        <a class="hbpdoc-toc-toggle pull-right" href>
            <span class="zmdi zmdi-menu"></span> <span class="sr-only icon-text">Menu</span>
        </a>
    </section>
    <section class="hbpdoc-main">
        <nav class="hbpdoc-sidebar hbpdoc-container">
            <a class="hbpdoc-toc-toggle pull-right" href>
                <span class="zmdi zmdi-menu"></span> <span class="sr-only icon-text">Menu</span>
            </a>
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
        </nav>

        <article class="hbpdoc-content">

            <div class="content">
                
                <div class="breadcrumb breadcrumb-meta expand">
                    
                    <a href="../../../index.html">Module code</a>
                    
                    <a href="../../../robot_designer_plugin.html">robot_designer_plugin</a>
                    
                </div>
                

                <aside class="hbpdoc-hnav hbpdoc-hnav-top">
                    
                    
                </aside>

                <h1>Source code for robot_designer_plugin.export.collada15.collada</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">xml.etree.cElementTree</span> <span class="k">as</span> <span class="nn">etree</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;[</span><span class="si">%(levelname)s</span><span class="s1">|</span><span class="si">%(name)s</span><span class="s1">:</span><span class="si">%(lineno)03d</span><span class="s1">] </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="COLLADA"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.COLLADA">[docs]</a><span class="k">class</span> <span class="nc">COLLADA</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="n">doc</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;COLLADA&quot;</span><span class="p">)</span>
        <span class="c1"># self.logger.setLevel(logging.INFO)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span> <span class="o">=</span> <span class="s1">&#39;http://www.collada.org/2008/03/COLLADASchema&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ns</span> <span class="o">=</span> <span class="s1">&#39;{</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span>

        <span class="c1"># Required simply for adding rigid_bodies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">physics_model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance_physics_model</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># searches the root node and replaces {ns} by the namespace prefix.</span>
    <span class="c1"># Additional replacements are given as keywordarguments.</span>
<div class="viewcode-block" id="COLLADA.iterfind"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.COLLADA.iterfind">[docs]</a>    <span class="k">def</span> <span class="nf">iterfind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">kw</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;ns&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="k">return</span> <span class="n">root</span><span class="o">.</span><span class="n">iterfind</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">))</span></div>

<div class="viewcode-block" id="COLLADA.findall"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.COLLADA.findall">[docs]</a>    <span class="k">def</span> <span class="nf">findall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">warning</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">kw</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;ns&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">warning</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No results for query: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">KW:</span><span class="si">%s</span><span class="se">\n</span><span class="s1">root:</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kw</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;XML element found&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="COLLADA.find"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.COLLADA.find">[docs]</a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">warning</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">kw</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;ns&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">warning</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No results for query: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">KW:</span><span class="si">%s</span><span class="se">\n</span><span class="s1">root:</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">kw</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;XML element found&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="COLLADA.getParent"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.COLLADA.getParent">[docs]</a>    <span class="k">def</span> <span class="nf">getParent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="n">it</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">iter</span><span class="p">()</span> <span class="k">if</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="COLLADA.getID"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.COLLADA.getID">[docs]</a>    <span class="k">def</span> <span class="nf">getID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">instance</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="COLLADA.setID"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.COLLADA.setID">[docs]</a>    <span class="k">def</span> <span class="nf">setID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="COLLADA.makeSIDREF"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.COLLADA.makeSIDREF">[docs]</a>    <span class="k">def</span> <span class="nf">makeSIDREF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_</span><span class="p">,</span> <span class="o">*</span><span class="n">sid</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">id_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sid&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sid</span><span class="p">])</span></div>

<div class="viewcode-block" id="COLLADA.makeSID"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.COLLADA.makeSID">[docs]</a>    <span class="k">def</span> <span class="nf">makeSID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_</span><span class="p">,</span> <span class="o">*</span><span class="n">sid</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;@&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">id_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sid&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sid</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sid&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sid</span><span class="p">])</span>
            <span class="k">raise</span> <span class="n">e</span></div>

<div class="viewcode-block" id="COLLADA.findByText"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.COLLADA.findByText">[docs]</a>    <span class="k">def</span> <span class="nf">findByText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">((</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="n">text</span><span class="p">))</span>  <span class="c1"># ,None)</span></div>
        <span class="c1"># return next((i for i in self.iterfind(s,root,**kw) if i.text==text))#,None)</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>

    <span class="c1"># Searchstrings formulated in ElemenPath (XPath for Elementree)</span>
    <span class="c1"># Helps resolving cross references within the collada document</span>
    <span class="c1"># should be used with collada.find() and collada.iterfind()</span>
    <span class="c1"># variables (in curly brackets) should then be specified as</span>
    <span class="c1"># keyword arguments in these functions with the exception of `root&#39; which is</span>
    <span class="c1"># reserved with the topmost Element to look in.</span>
    <span class="c1"># E.g., collada.find(KINEMATICS_MODEL_ID,id=&quot;Armar4&quot;)</span>

    <span class="n">VISUAL_SCENE</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">library_visual_scenes/</span><span class="si">{ns}</span><span class="s1">visual_scene&#39;</span>
    <span class="n">VISUAL_SCENE_ID</span> <span class="o">=</span> <span class="n">VISUAL_SCENE</span> <span class="o">+</span> <span class="s1">&#39;[@id=&quot;</span><span class="si">{id}</span><span class="s1">&quot;]&#39;</span>
    <span class="n">VISUAL_SCENE_TYPE_SID</span> <span class="o">=</span> <span class="n">VISUAL_SCENE_ID</span> <span class="o">+</span> \
        <span class="s1">&#39;//</span><span class="si">{ns}</span><span class="s1">node[@sid=&quot;</span><span class="si">{sid}</span><span class="s1">&quot;][@type=&quot;</span><span class="si">{type}</span><span class="s1">&quot;]&#39;</span>  <span class="c1"># Type either &#39;JOINT&#39; or &#39;NODE&#39;</span>
    <span class="n">VISUAL_SCENE_SID</span> <span class="o">=</span> <span class="n">VISUAL_SCENE_ID</span> <span class="o">+</span> <span class="s1">&#39;//</span><span class="si">{ns}</span><span class="s1">node[@sid=&quot;</span><span class="si">{sid}</span><span class="s1">&quot;]&#39;</span>
    <span class="n">VISUAL_SCENE_NAME</span> <span class="o">=</span> <span class="n">VISUAL_SCENE_ID</span> <span class="o">+</span> <span class="s1">&#39;//</span><span class="si">{ns}</span><span class="s1">node[@name=&quot;</span><span class="si">{name}</span><span class="s1">&quot;]&#39;</span>
    <span class="n">VISUAL_SCENE_2SID</span> <span class="o">=</span> <span class="n">VISUAL_SCENE_SID</span> <span class="o">+</span> <span class="s1">&#39;//*[@sid=&quot;</span><span class="si">{sid2}</span><span class="s1">&quot;]&#39;</span>

    <span class="n">JOINT</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">library_joints/</span><span class="si">{ns}</span><span class="s1">joint&#39;</span>
    <span class="n">JOINT_ID</span> <span class="o">=</span> <span class="n">JOINT</span> <span class="o">+</span> <span class="s1">&#39;[@id=&quot;</span><span class="si">{id}</span><span class="s1">&quot;]&#39;</span>
    <span class="n">JOINT_SID</span> <span class="o">=</span> <span class="n">JOINT_ID</span> <span class="o">+</span> <span class="s1">&#39;//*[@sid=&quot;</span><span class="si">{sid}</span><span class="s1">&quot;]&#39;</span>

    <span class="n">KINEMATICS_MODEL</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">library_kinematics_models/</span><span class="si">{ns}</span><span class="s1">kinematics_model&#39;</span>
    <span class="n">KINEMATICS_MODEL_ID</span> <span class="o">=</span> <span class="n">KINEMATICS_MODEL</span> <span class="o">+</span> <span class="s1">&#39;[@id=&quot;</span><span class="si">{id}</span><span class="s1">&quot;]&#39;</span>
    <span class="n">KINEMATICS_MODEL_SID</span> <span class="o">=</span> <span class="n">KINEMATICS_MODEL_ID</span> <span class="o">+</span> <span class="s1">&#39;//*[@sid=&quot;</span><span class="si">{sid}</span><span class="s1">&quot;]&#39;</span>

    <span class="n">ARTICULATED_SYSTEMS_MOTION</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">library_articulated_systems/</span><span class="si">{ns}</span><span class="s1">articulated_system[</span><span class="si">{ns}</span><span class="s1">motion]&#39;</span>
    <span class="n">ARTICULATED_SYSTEMS_MOTION_ID</span> <span class="o">=</span> <span class="n">ARTICULATED_SYSTEMS_MOTION</span> <span class="o">+</span> <span class="s1">&#39;[@id=&quot;</span><span class="si">{id}</span><span class="s1">&quot;]&#39;</span>
    <span class="n">ARTICULATED_SYSTEMS_MOTION_SID</span> <span class="o">=</span> <span class="n">ARTICULATED_SYSTEMS_MOTION_ID</span> <span class="o">+</span> <span class="s1">&#39;//*[@sid=&quot;</span><span class="si">{sid}</span><span class="s1">&quot;]&#39;</span>
    <span class="n">ARTICULATED_SYSTEMS_MOTION_AXIS_INFO</span> <span class="o">=</span> <span class="n">ARTICULATED_SYSTEMS_MOTION_ID</span> <span class="o">+</span> \
        <span class="s1">&#39;/</span><span class="si">{ns}</span><span class="s1">motion/</span><span class="si">{ns}</span><span class="s1">technique_common/</span><span class="si">{ns}</span><span class="s1">axis_info[@axis=&quot;</span><span class="si">{axis}</span><span class="s1">&quot;]&#39;</span>

    <span class="n">ARTICULATED_SYSTEMS_KINEMATICS</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">library_articulated_systems/</span><span class="si">{ns}</span><span class="s1">articulated_system[</span><span class="si">{ns}</span><span class="s1">kinematics]&#39;</span>
    <span class="n">ARTICULATED_SYSTEMS_KINEMATICS_ID</span> <span class="o">=</span> <span class="n">ARTICULATED_SYSTEMS_KINEMATICS</span> <span class="o">+</span> <span class="s1">&#39;[@id=&quot;</span><span class="si">{id}</span><span class="s1">&quot;]&#39;</span>
    <span class="n">ARTICULATED_SYSTEMS_KINEMATICS_SID</span> <span class="o">=</span> <span class="n">ARTICULATED_SYSTEMS_KINEMATICS_ID</span> <span class="o">+</span> <span class="s1">&#39;//*[@sid=&quot;</span><span class="si">{sid}</span><span class="s1">&quot;]&#39;</span>
    <span class="n">ARTICULATED_SYSTEMS_KINEMATICS_AXIS_INFO</span> <span class="o">=</span> <span class="n">ARTICULATED_SYSTEMS_KINEMATICS_ID</span> <span class="o">+</span> \
        <span class="s1">&#39;/</span><span class="si">{ns}</span><span class="s1">kinematics/</span><span class="si">{ns}</span><span class="s1">technique_common/</span><span class="si">{ns}</span><span class="s1">axis_info[@axis=&quot;</span><span class="si">{axis}</span><span class="s1">&quot;]&#39;</span>

    <span class="n">KINEMATICS_SCENES</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">library_kinematics_scenes/</span><span class="si">{ns}</span><span class="s1">kinematics_scene&#39;</span>
    <span class="n">KINEMATICS_SCENES_ID</span> <span class="o">=</span> <span class="n">KINEMATICS_SCENES</span> <span class="o">+</span> <span class="s1">&#39;[@id=&quot;</span><span class="si">{id}</span><span class="s1">&quot;]&#39;</span>
    <span class="n">KINEMATICS_SCENES_SYMBOL</span> <span class="o">=</span> <span class="n">KINEMATICS_SCENES_ID</span> <span class="o">+</span> <span class="s1">&#39;//*[@symbol=&quot;</span><span class="si">{symbol}</span><span class="s1">&quot;]&#39;</span>

    <span class="n">SCENE</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">scene&#39;</span>
    <span class="n">SCENE_INSTANCE_KINEMATICS_SCENE</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">scene/</span><span class="si">{ns}</span><span class="s1">instance_kinematics_scene&#39;</span>
    <span class="n">SCENE_INSTANCE_VISUAL_SCENE</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">scene/</span><span class="si">{ns}</span><span class="s1">instance_visual_scene&#39;</span>

    <span class="n">SCENE_BIND_JOINT_AXIS</span> <span class="o">=</span> <span class="n">SCENE_INSTANCE_KINEMATICS_SCENE</span> <span class="o">+</span> <span class="s1">&#39;/</span><span class="si">{ns}</span><span class="s1">bind_joint_axis&#39;</span>
    <span class="n">SCENE_BIND_JOINT_AXIS_TARGET</span> <span class="o">=</span> <span class="n">SCENE_BIND_JOINT_AXIS</span> <span class="o">+</span> <span class="s1">&#39;[@target=&quot;</span><span class="si">{target}</span><span class="s1">&quot;]&#39;</span>
    <span class="n">SCENE_BIND_KINEMATICS_MODEL</span> <span class="o">=</span> <span class="n">SCENE_INSTANCE_KINEMATICS_SCENE</span> <span class="o">+</span> <span class="s1">&#39;/</span><span class="si">{ns}</span><span class="s1">bind_kinematics_model&#39;</span>
    <span class="n">SCENE_BIND_KINEMATICS_MODEL_NODE</span> <span class="o">=</span> <span class="n">SCENE_BIND_KINEMATICS_MODEL</span> <span class="o">+</span> <span class="s1">&#39;[@node=&quot;</span><span class="si">{node}</span><span class="s1">&quot;]&#39;</span>

    <span class="n">LIBRARY_PHYSICS_SCENES</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">library_physics_scenes&#39;</span>
    <span class="n">LIBRARY_PHYSICS_MODELS</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">library_physics_models&#39;</span>

<div class="viewcode-block" id="COLLADA.SubElement"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.COLLADA.SubElement">[docs]</a>    <span class="k">def</span> <span class="nf">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">attrib</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">attrib</span><span class="p">:</span>
            <span class="n">attrib</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">tag</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">),</span> <span class="n">attrib</span><span class="p">)</span></div>

<div class="viewcode-block" id="COLLADA.SubInstance"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.COLLADA.SubInstance">[docs]</a>    <span class="k">def</span> <span class="nf">SubInstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">instance_&#39;</span><span class="p">)</span>
        <span class="c1"># self.logger.debug(&#39;tag: %s&#39;, tag)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span>
                               <span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="n">element</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span> <span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s2">&quot;inst_&quot;</span> <span class="o">+</span> <span class="n">element</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)})</span></div>

<div class="viewcode-block" id="COLLADA.import14"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.COLLADA.import14">[docs]</a>    <span class="k">def</span> <span class="nf">import14</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">old_namespace</span> <span class="o">=</span> <span class="s1">&#39;http://www.collada.org/2005/11/COLLADASchema&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="s1">&#39;1.5.0&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">iter</span><span class="p">():</span>
            <span class="n">i</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;{</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="n">old_namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span></div>

<div class="viewcode-block" id="COLLADA.export14"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.COLLADA.export14">[docs]</a>    <span class="k">def</span> <span class="nf">export14</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Warning modifies the whole tree!!!&quot;&quot;&quot;</span>
        <span class="n">old_namespace</span> <span class="o">=</span> <span class="s1">&#39;http://www.collada.org/2005/11/COLLADASchema&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="s1">&#39;1.4.1&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">iter</span><span class="p">():</span>
            <span class="n">i</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;{</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">,</span> <span class="n">old_namespace</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">iter</span><span class="p">()</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;JOINT&quot;</span><span class="p">):</span>
            <span class="n">joint</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s2">&quot;NODE&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="COLLADA.read"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.COLLADA.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span></div>

<div class="viewcode-block" id="COLLADA.write"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.COLLADA.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="c1"># Output does not look nice. Use `xmllint --format &lt;input&gt; &gt; &lt;output&gt;&#39;</span>
        <span class="c1"># to get a nice format (part of libxml2)</span>

        <span class="n">etree</span><span class="o">.</span><span class="n">register_namespace</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="COLLADA.attach"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.COLLADA.attach">[docs]</a>    <span class="k">def</span> <span class="nf">attach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">armature</span><span class="p">,</span> <span class="n">meshes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">meshes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">armature</span><span class="o">.</span><span class="n">connectMeshes</span><span class="p">(</span><span class="n">meshes</span><span class="p">)</span>

        <span class="n">library_kinematics_scenes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">library_kinematics_scenes&#39;</span><span class="p">)</span>
        <span class="n">library_kinematics_models</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">library_kinematics_models&#39;</span><span class="p">)</span>
        <span class="n">library_articulated_systems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">library_articulated_systems&#39;</span><span class="p">)</span>
        <span class="n">library_joints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">library_joints&#39;</span><span class="p">)</span>

        <span class="n">kinematics_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">library_kinematics_models</span><span class="p">,</span>
                                           <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">kinematics_model&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">armature</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_kinematics_model&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;kin mod:</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">kinematics_model</span><span class="p">))</span>
        <span class="n">kinematics_model_technique</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">kinematics_model</span><span class="p">,</span>
                                                     <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">technique_common&#39;</span><span class="p">)</span>

        <span class="n">AS_kinematics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">library_articulated_systems</span><span class="p">,</span>
                                        <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">articulated_system&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">armature</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_kinematics&#39;</span><span class="p">})</span>
        <span class="n">kinematics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">AS_kinematics</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">kinematics&#39;</span><span class="p">)</span>

        <span class="n">instance_kinematics_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubInstance</span><span class="p">(</span><span class="n">kinematics</span><span class="p">,</span> <span class="n">kinematics_model</span><span class="p">)</span>
        <span class="n">newparam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">instance_kinematics_model</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">newparam&#39;</span><span class="p">,</span>
                                   <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSID</span><span class="p">(</span><span class="n">AS_kinematics</span><span class="p">,</span> <span class="n">instance_kinematics_model</span><span class="p">)})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">newparam</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">SIDREF&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSIDREF</span><span class="p">(</span><span class="n">AS_kinematics</span><span class="p">,</span> <span class="n">instance_kinematics_model</span><span class="p">)</span>
        <span class="n">AS_kinematics_technique</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">kinematics</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">technique_common&#39;</span><span class="p">)</span>

        <span class="n">AS_motion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">library_articulated_systems</span><span class="p">,</span>
                                    <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">articulated_system&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">armature</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_motion&#39;</span><span class="p">})</span>
        <span class="n">motion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">AS_motion</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">motion&#39;</span><span class="p">)</span>
        <span class="n">instance_AS_kinematics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubInstance</span><span class="p">(</span><span class="n">motion</span><span class="p">,</span> <span class="n">AS_kinematics</span><span class="p">)</span>
        <span class="n">newparam2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">instance_AS_kinematics</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">newparam&#39;</span><span class="p">,</span>
                                    <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSID</span><span class="p">(</span><span class="n">AS_motion</span><span class="p">,</span> <span class="n">newparam</span><span class="p">)})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">newparam2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">SIDREF&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSIDREF</span><span class="p">(</span><span class="n">AS_kinematics</span><span class="p">,</span> <span class="n">newparam</span><span class="p">)</span>
        <span class="n">AS_motion_technique</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">motion</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">technique_common&#39;</span><span class="p">)</span>

        <span class="n">kinematics_scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">library_kinematics_scenes</span><span class="p">,</span>
                                           <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">kinematics_scene&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">armature</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_kinematics_scene&#39;</span><span class="p">})</span>
        <span class="n">instance_AS_motion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubInstance</span><span class="p">(</span><span class="n">kinematics_scene</span><span class="p">,</span> <span class="n">AS_motion</span><span class="p">)</span>
        <span class="n">bind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">instance_AS_motion</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">bind&#39;</span><span class="p">,</span>
                               <span class="p">{</span><span class="s1">&#39;symbol&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSID</span><span class="p">(</span><span class="n">kinematics_scene</span><span class="p">,</span> <span class="n">newparam2</span><span class="p">)})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">bind</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">param&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSIDREF</span><span class="p">(</span><span class="n">AS_motion</span><span class="p">,</span> <span class="n">newparam2</span><span class="p">)})</span>

        <span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">SCENE</span><span class="p">)</span>

        <span class="c1"># Create and export the tags required for rigid body dynamics!</span>
        <span class="c1"># Models are still attached in a separate function (TODO)</span>
        <span class="n">library_physics_models</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">library_physics_models&#39;</span><span class="p">)</span>
        <span class="n">library_physics_scenes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">library_physics_scenes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">physics_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">library_physics_models</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">physics_model&#39;</span><span class="p">,</span>
                                             <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">armature</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_physics_model&#39;</span><span class="p">})</span>
        <span class="n">physics_scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">library_physics_scenes</span><span class="p">,</span> <span class="s1">&#39;physics_scene&#39;</span><span class="p">,</span>
                                        <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">armature</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_physics_scene&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance_physics_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubInstance</span><span class="p">(</span><span class="n">physics_scene</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">physics_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">physics_scene</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">technique_common&#39;</span><span class="p">)</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">SCENE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">instance_physics_scene&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="n">armature</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_physics_scene&#39;</span><span class="p">})</span>
        <span class="c1"># TODO make a method that creates a referenceable node (adding the #)</span>

        <span class="c1"># scene gotta be the last element!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>

        <span class="n">instance_visual_scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">SCENE_INSTANCE_VISUAL_SCENE</span><span class="p">)</span>
        <span class="c1"># visual_scene = self.find(COLLADA.VISUAL_SCENE_ID,id=self.getID(instance_visual_scene))</span>

        <span class="c1"># root_node = self.find(COLLADA.VISUAL_SCENE_SID,</span>
        <span class="c1">#            id=self.getID(instance_visual_scene),sid=armature.name)</span>
        <span class="c1"># Note that this is irrelevant for import. If this changes, the root</span>
        <span class="c1"># node has to be addressed through an ID tag - not an SID!</span>

        <span class="c1"># OpenRAVE specific entries</span>
        <span class="n">extra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">AS_motion</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">extra&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;manipulator&#39;</span><span class="p">})</span>
        <span class="n">OR_technique</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">extra</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">technique&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="s1">&#39;OpenRAVE&#39;</span><span class="p">})</span>

        <span class="n">instance_kinematics_scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubInstance</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">kinematics_scene</span><span class="p">)</span>
        <span class="n">bind_kinematics_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">instance_kinematics_scene</span><span class="p">,</span>
                                                <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">bind_kinematics_model&#39;</span><span class="p">,</span>
                                                <span class="p">{</span><span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="n">armature</span><span class="o">.</span><span class="n">name</span><span class="p">})</span>  <span class="c1"># as soon as we can.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">bind_kinematics_model</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">param&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">bind</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;symbol&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">parseArmature</span><span class="p">(</span><span class="n">armatureJoint</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

            <span class="n">joint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">library_joints</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">joint&#39;</span><span class="p">,</span>
                                    <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">armatureJoint</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_joint&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">armatureJoint</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_joint&#39;</span><span class="p">})</span>
            <span class="n">axis_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">joint</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">armatureJoint</span><span class="o">.</span><span class="n">axis_type</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;axis0&#39;</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">axis_type</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">axis&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">armatureJoint</span><span class="o">.</span><span class="n">axis</span><span class="p">)</span>
            <span class="n">instance_joint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubInstance</span><span class="p">(</span><span class="n">kinematics_model_technique</span><span class="p">,</span> <span class="n">joint</span><span class="p">)</span>
            <span class="c1"># Preserve order of elements. Insert Joints from above.</span>
            <span class="n">kinematics_model_technique</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">instance_joint</span><span class="p">)</span>
            <span class="n">kinematics_model_technique</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">instance_joint</span><span class="p">)</span>

            <span class="c1"># Axis</span>
            <span class="n">newparam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">instance_kinematics_model</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">newparam&#39;</span><span class="p">,</span>
                                       <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSID</span><span class="p">(</span><span class="n">AS_kinematics</span><span class="p">,</span> <span class="n">instance_kinematics_model</span><span class="p">,</span> <span class="n">instance_joint</span><span class="p">,</span>
                                                            <span class="n">axis_type</span><span class="p">)})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">newparam</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">SIDREF&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">makeSIDREF</span><span class="p">(</span><span class="n">AS_kinematics</span><span class="p">,</span> <span class="n">instance_kinematics_model</span><span class="p">,</span> <span class="n">instance_joint</span><span class="p">,</span> <span class="n">axis_type</span><span class="p">)</span>
            <span class="n">newparam2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">instance_AS_kinematics</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">newparam&#39;</span><span class="p">,</span>
                                        <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSID</span><span class="p">(</span><span class="n">AS_motion</span><span class="p">,</span> <span class="n">newparam</span><span class="p">)})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">newparam2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">SIDREF&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSIDREF</span><span class="p">(</span><span class="n">AS_kinematics</span><span class="p">,</span> <span class="n">newparam</span><span class="p">)</span>

            <span class="n">bind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">instance_AS_motion</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">bind&#39;</span><span class="p">,</span>
                                   <span class="p">{</span><span class="s1">&#39;symbol&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSID</span><span class="p">(</span><span class="n">kinematics_scene</span><span class="p">,</span> <span class="n">newparam2</span><span class="p">)})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">bind</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">param&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSIDREF</span><span class="p">(</span><span class="n">AS_motion</span><span class="p">,</span> <span class="n">newparam2</span><span class="p">)})</span>

            <span class="c1"># Target node &amp; transformation</span>

            <span class="n">joint_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">VISUAL_SCENE_TYPE_SID</span><span class="p">,</span>
                                   <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getID</span><span class="p">(</span><span class="n">instance_visual_scene</span><span class="p">),</span>
                                   <span class="n">sid</span><span class="o">=</span><span class="n">armatureJoint</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                   <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;JOINT&#39;</span><span class="p">)</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="n">joint_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;./*[@sid=&quot;transform&quot;]&#39;</span><span class="p">)</span>
            <span class="c1"># Ist eine Matrix - eventuell durch einfache rotation/translation ersetzen.</span>

            <span class="n">bind_joint_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">instance_kinematics_scene</span><span class="p">,</span>
                                              <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">bind_joint_axis&#39;</span><span class="p">,</span>
                                              <span class="p">{</span><span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="n">armatureJoint</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;/transform&#39;</span><span class="p">})</span>  <span class="c1"># As soon as we can ...</span>

            <span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">bind_joint_axis</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">axis&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">param&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">bind</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;symbol&#39;</span><span class="p">)</span>

            <span class="c1"># Initial Values</span>
            <span class="n">newparam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">instance_kinematics_model</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">newparam&#39;</span><span class="p">,</span>
                                       <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSID</span><span class="p">(</span><span class="n">AS_kinematics</span><span class="p">,</span> <span class="n">instance_kinematics_model</span><span class="p">,</span>
                                                            <span class="n">instance_joint</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_value&#39;</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">newparam</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">armatureJoint</span><span class="o">.</span><span class="n">initialValue</span>

            <span class="n">newparam2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">instance_AS_kinematics</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">newparam&#39;</span><span class="p">,</span>
                                        <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSID</span><span class="p">(</span><span class="n">AS_motion</span><span class="p">,</span> <span class="n">newparam</span><span class="p">)})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">newparam2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">SIDREF&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSIDREF</span><span class="p">(</span><span class="n">AS_kinematics</span><span class="p">,</span> <span class="n">newparam</span><span class="p">)</span>

            <span class="n">bind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">instance_AS_motion</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">bind&#39;</span><span class="p">,</span>
                                   <span class="p">{</span><span class="s1">&#39;symbol&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSID</span><span class="p">(</span><span class="n">kinematics_scene</span><span class="p">,</span> <span class="n">newparam2</span><span class="p">)})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">bind</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">param&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSIDREF</span><span class="p">(</span><span class="n">AS_motion</span><span class="p">,</span> <span class="n">newparam2</span><span class="p">)})</span>

            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">bind_joint_axis</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">value&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">param&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">bind</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;symbol&#39;</span><span class="p">)</span>

            <span class="c1"># Axis information in &lt;kinematics&gt;</span>
            <span class="n">axis_info_kinematics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">AS_kinematics_technique</span><span class="p">,</span>
                                                   <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">axis_info&#39;</span><span class="p">,</span> <span class="p">{</span>
                                                       <span class="s1">&#39;axis&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSIDREF</span><span class="p">(</span><span class="n">kinematics_model</span><span class="p">,</span> <span class="n">instance_joint</span><span class="p">,</span>
                                                                               <span class="n">axis_type</span><span class="p">),</span>
                                                       <span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="n">instance_joint</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sid&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_info&#39;</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">axis_info_kinematics</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">active&#39;</span><span class="p">),</span>
                            <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">bool&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">armatureJoint</span><span class="o">.</span><span class="n">active</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">axis_info_kinematics</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">locked&#39;</span><span class="p">),</span>
                            <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">bool&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">armatureJoint</span><span class="o">.</span><span class="n">locked</span>

            <span class="n">limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">axis_info_kinematics</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">limits&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">limits</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">min&#39;</span><span class="p">),</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">armatureJoint</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">limits</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">max&#39;</span><span class="p">),</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">armatureJoint</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>

            <span class="c1"># Axis information in &lt;motoin&gt;</span>
            <span class="n">axis_info_motion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">AS_motion_technique</span><span class="p">,</span>
                                               <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">axis_info&#39;</span><span class="p">,</span>
                                               <span class="p">{</span><span class="s1">&#39;axis&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSIDREF</span><span class="p">(</span><span class="n">AS_kinematics</span><span class="p">,</span> <span class="n">axis_info_kinematics</span><span class="p">)})</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">axis_info_motion</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">speed&#39;</span><span class="p">),</span>
                            <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">armatureJoint</span><span class="o">.</span><span class="n">speed</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">axis_info_motion</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">acceleration&#39;</span><span class="p">),</span>
                            <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">armatureJoint</span><span class="o">.</span><span class="n">acceleration</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">axis_info_motion</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">deceleration&#39;</span><span class="p">),</span>
                            <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">armatureJoint</span><span class="o">.</span><span class="n">deceleration</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">axis_info_motion</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">jerk&#39;</span><span class="p">),</span>
                            <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">armatureJoint</span><span class="o">.</span><span class="n">jerk</span><span class="p">)</span>

            <span class="n">attachment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">attachment_full&#39;</span><span class="p">,</span>
                                         <span class="p">{</span><span class="s1">&#39;joint&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSIDREF</span><span class="p">(</span><span class="n">kinematics_model</span><span class="p">,</span> <span class="n">instance_joint</span><span class="p">)})</span>

            <span class="k">for</span> <span class="n">trafo</span> <span class="ow">in</span> <span class="n">armatureJoint</span><span class="o">.</span><span class="n">transformations</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trafo</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">el</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">attachment</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">translate&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">trafo</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">el</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">attachment</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">rotate&#39;</span><span class="p">)</span>
                <span class="n">el</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trafo</span><span class="p">)</span>
            <span class="c1"># # Add offset transformation</span>
            <span class="c1">#            if len(armatureJoint.offsetTransformation)==3:</span>
            <span class="c1">#                el=self.SubElement(attachment,&#39;{ns}translate&#39;)</span>
            <span class="c1">#            elif len(armatureJoint.offsetTransformation)==4:</span>
            <span class="c1">#                el=self.SubElement(attachment,&#39;{ns}rotate&#39;)</span>
            <span class="c1">#            el.text = &quot; &quot;.join(str(i) for i in armatureJoint.offsetTransformation)</span>
            <span class="c1">#            el.set(&#39;sid&#39;,&#39;offset&#39;)</span>

            <span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">attachment</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">link&#39;</span><span class="p">,</span>
                                   <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="n">armatureJoint</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_link&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">armatureJoint</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_link&#39;</span><span class="p">})</span>

            <span class="c1"># OpenRAVE specific</span>
            <span class="k">if</span> <span class="n">armatureJoint</span><span class="o">.</span><span class="n">frame_origin</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">OR_technique</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">frame_origin&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;link&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSIDREF</span><span class="p">(</span><span class="n">kinematics_model</span><span class="p">,</span> <span class="n">parent</span><span class="p">)})</span>
            <span class="k">if</span> <span class="n">armatureJoint</span><span class="o">.</span><span class="n">frame_tip</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">OR_technique</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">frame_tip&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;link&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSIDREF</span><span class="p">(</span><span class="n">kinematics_model</span><span class="p">,</span> <span class="n">link</span><span class="p">)})</span>
            <span class="k">if</span> <span class="n">armatureJoint</span><span class="o">.</span><span class="n">isGripper</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">OR_technique</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">gripper_joint&#39;</span><span class="p">,</span>
                                    <span class="p">{</span><span class="s1">&#39;joint&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSIDREF</span><span class="p">(</span><span class="n">kinematics_model</span><span class="p">,</span> <span class="n">instance_joint</span><span class="p">)})</span>
                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;closing_direction&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;axis&#39;</span><span class="p">:</span> <span class="n">axis_type</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sid&#39;</span><span class="p">)})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">armatureJoint</span><span class="o">.</span><span class="n">closingDirection</span><span class="p">)</span>

            <span class="c1"># for sensor in [i for i in armatureJoint.meshes if i.find (&#39;VICON_&#39;)==0]:</span>
            <span class="k">for</span> <span class="n">sensor</span><span class="p">,</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">armatureJoint</span><span class="o">.</span><span class="n">markers</span><span class="p">:</span>
                <span class="n">extra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">AS_motion</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">extra&#39;</span><span class="p">,</span>
                                        <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;attach_sensor&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">sensor</span><span class="p">})</span>  <span class="c1"># .replace(&#39;VICON_&#39;,&#39;&#39;)})</span>
                <span class="n">technique</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">extra</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">technique&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="s1">&#39;OpenRAVE&#39;</span><span class="p">})</span>
                <span class="c1"># node = self.find(COLLADA.VISUAL_SCENE_NAME,  id=self.getID(instance_visual_scene), name=sensor)</span>
                <span class="n">frame_origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">technique</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">frame_origin&#39;</span><span class="p">,</span>
                                               <span class="p">{</span><span class="s1">&#39;link&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSIDREF</span><span class="p">(</span><span class="n">kinematics_model</span><span class="p">,</span> <span class="n">link</span><span class="p">)})</span>
                <span class="c1"># Add the same trafos as in the visual scene!</span>
                <span class="c1"># for transform in (i for i in node.getchildren() if i.tag.find(&#39;instance_&#39;) == -1 ):</span>
                <span class="c1">#    frame_origin.append(transform)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">frame_origin</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">translate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">position</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">technique</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">instance_sensor&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;sensors.dae#Vicon&#39;</span><span class="p">})</span>

            <span class="c1"># Continue Recursion</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">armatureJoint</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">parseArmature</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">root_link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">kinematics_model_technique</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">link&#39;</span><span class="p">,</span>
                                    <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="n">armature</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_root_link&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">armature</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_root_link&#39;</span><span class="p">})</span>

        <span class="c1"># OpenRAVE specific</span>
        <span class="k">if</span> <span class="n">armature</span><span class="o">.</span><span class="n">frame_origin</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">OR_technique</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">frame_origin&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;link&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeSIDREF</span><span class="p">(</span><span class="n">kinematics_model</span><span class="p">,</span> <span class="n">root_link</span><span class="p">)})</span>

        <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="n">armature</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">parseArmature</span><span class="p">(</span><span class="n">joint</span><span class="p">,</span> <span class="n">root_link</span><span class="p">)</span></div>

<div class="viewcode-block" id="COLLADA.addSensors"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.COLLADA.addSensors">[docs]</a>    <span class="k">def</span> <span class="nf">addSensors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="COLLADA.extract"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.COLLADA.extract">[docs]</a>    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">armature</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">()</span>

        <span class="c1"># Import of COLLADA v1.5:</span>
        <span class="c1"># Outline:</span>
        <span class="c1"># 1) explore the &lt;scene&gt;/&lt;instance_kinematics_scene&gt;, look for bindings of the kinematics model.</span>
        <span class="c1"># 2) In &lt;kinematics_scene&gt; the model is either directly instantiated (NOT supported)</span>
        <span class="c1">#    or combined with dynamics and/or additional kinematic information (both required).</span>
        <span class="c1">#    Only the &lt;articulated_system&gt; with a &lt;motion&gt; element is instantiated in the</span>
        <span class="c1">#    &lt;kinematics_scene&gt;. The &lt;articulated_system&gt; with the &lt;kinematics_element&gt; is intatiated</span>
        <span class="c1">#    in there. This last element is the place where the &lt;kinematics_model&gt; is finally</span>
        <span class="c1">#    intatiated. This second step resolves/finds the correct model.</span>
        <span class="c1"># 3) The tree structure of the &lt;kinematics_model&gt; is parsed. Every joint(-axis) encountered</span>
        <span class="c1">#    gets its kinematic and dynamic information extracted. This requires visiting the</span>
        <span class="c1">#    whole structure up to the &lt;scene&gt;-object. That way the associated &lt;node&gt; of the</span>
        <span class="c1">#    current &lt;visual_scene&gt; is found.</span>
        <span class="c1"># 4) With the &lt;node&gt; known for each joint, the meshes can be connected. This is done by getting</span>
        <span class="c1">#    The parent node of the transformation in the visual scene. Every &lt;instance_geometry&gt; deeper in</span>
        <span class="c1">#    the hierarchy is assigned to the joint. This assignment takes place in the recursion of 3)</span>
        <span class="c1">#    The assignment consequently gets overriden by child joints. The association is stored in a global</span>
        <span class="c1">#    dict that is returned at the end.</span>
        <span class="c1"># 5) OpenRAVE requires additional information stored in the &lt;extra&gt;/&lt;technique profile=&quot;OpenRAVE&quot;&gt;</span>
        <span class="c1">#    element. Parameters are stored in local variables/dictionaries. (This step is actually</span>
        <span class="c1">#    performed earlier during 2) when the &lt;articulated_system&gt; with &lt;motion&gt; is detected)</span>
        <span class="c1">#    Limitations: 1 axis per joint,</span>

        <span class="n">instance_kinematics_scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">SCENE_INSTANCE_KINEMATICS_SCENE</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">instance_visual_scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">SCENE_INSTANCE_VISUAL_SCENE</span><span class="p">)</span>
            <span class="n">visual_scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">VISUAL_SCENE_ID</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getID</span><span class="p">(</span><span class="n">instance_visual_scene</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No visual scene found!&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">bind_kinematics_model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">SCENE_BIND_KINEMATICS_MODEL</span><span class="p">):</span>
            <span class="n">sid</span> <span class="o">=</span> <span class="n">bind_kinematics_model</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># sid:</span>
                <span class="c1"># print(sid)</span>
                <span class="n">armature</span><span class="o">.</span><span class="n">root_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">VISUAL_SCENE_SID</span><span class="p">,</span>
                                               <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getID</span><span class="p">(</span><span class="n">instance_visual_scene</span><span class="p">),</span> <span class="n">sid</span><span class="o">=</span><span class="n">sid</span><span class="p">)</span>  <span class="c1"># irrelevant for import</span>
            <span class="c1">#</span>
            <span class="n">symbol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">param&#39;</span><span class="p">,</span> <span class="n">bind_kinematics_model</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="n">bind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">KINEMATICS_SCENES_SYMBOL</span><span class="p">,</span>
                             <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getID</span><span class="p">(</span><span class="n">instance_kinematics_scene</span><span class="p">),</span> <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span>

            <span class="c1"># Convenience: articulated_system -&gt; AS</span>
            <span class="n">instance_AS_motion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getParent</span><span class="p">(</span><span class="n">bind</span><span class="p">)</span>
            <span class="n">AS_motion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">ARTICULATED_SYSTEMS_MOTION_ID</span><span class="p">,</span>
                                  <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getID</span><span class="p">(</span><span class="n">instance_AS_motion</span><span class="p">))</span>

            <span class="n">instance_AS_kinematics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">motion/</span><span class="si">{ns}</span><span class="s1">instance_articulated_system&#39;</span><span class="p">,</span>
                                               <span class="n">AS_motion</span><span class="p">)</span>
            <span class="n">AS_kinematics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">ARTICULATED_SYSTEMS_KINEMATICS</span><span class="p">,</span>
                                      <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getID</span><span class="p">(</span><span class="n">instance_AS_kinematics</span><span class="p">))</span>

            <span class="p">[</span><span class="nb">id</span><span class="p">,</span> <span class="n">sid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">param&#39;</span><span class="p">,</span> <span class="n">bind</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="p">(</span><span class="nb">id</span> <span class="o">==</span> <span class="n">AS_motion</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span>
            <span class="n">newparam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">ARTICULATED_SYSTEMS_MOTION_SID</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">sid</span><span class="o">=</span><span class="n">sid</span><span class="p">)</span>
            <span class="p">[</span><span class="nb">id</span><span class="p">,</span> <span class="n">sid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">SIDREF&#39;</span><span class="p">,</span> <span class="n">newparam</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">newparam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">ARTICULATED_SYSTEMS_KINEMATICS_SID</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">sid</span><span class="o">=</span><span class="n">sid</span><span class="p">)</span>
            <span class="p">[</span><span class="nb">id</span><span class="p">,</span> <span class="n">sid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">SIDREF&#39;</span><span class="p">,</span> <span class="n">newparam</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">instance_kinematics_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">ARTICULATED_SYSTEMS_KINEMATICS_SID</span><span class="p">,</span>
                                                  <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">sid</span><span class="o">=</span><span class="n">sid</span><span class="p">)</span>

            <span class="n">id_kinematics_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getID</span><span class="p">(</span><span class="n">instance_kinematics_model</span><span class="p">)</span>
            <span class="n">kinematics_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">KINEMATICS_MODEL</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">id_kinematics_model</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Found kinematics model: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">kinematics_model</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating Armature: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">kinematics_model</span><span class="p">[:</span><span class="o">-</span><span class="mi">9</span><span class="p">])</span>

            <span class="c1"># Fetch the extra OpenRAVE information</span>
            <span class="n">frame_origin</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">frame_tip</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">gripper_axes</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="p">[</span><span class="nb">id</span><span class="p">,</span> <span class="n">sid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">extra[@type=&quot;manipulator&quot;]/</span><span class="si">{ns}</span><span class="s1">technique[@profile=&quot;OpenRAVE&quot;]/</span><span class="si">{ns}</span><span class="s1">frame_origin&#39;</span><span class="p">,</span>
                    <span class="n">root</span><span class="o">=</span><span class="n">AS_motion</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;link&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
                <span class="n">frame_origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">KINEMATICS_MODEL_SID</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">sid</span><span class="o">=</span><span class="n">sid</span><span class="p">)</span>
                <span class="p">[</span><span class="nb">id</span><span class="p">,</span> <span class="n">sid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">extra[@type=&quot;manipulator&quot;]/</span><span class="si">{ns}</span><span class="s1">technique[@profile=&quot;OpenRAVE&quot;]/</span><span class="si">{ns}</span><span class="s1">frame_tip&#39;</span><span class="p">,</span>
                    <span class="n">root</span><span class="o">=</span><span class="n">AS_motion</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;link&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
                <span class="n">frame_tip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">KINEMATICS_MODEL_SID</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">sid</span><span class="o">=</span><span class="n">sid</span><span class="p">)</span>
                <span class="c1"># dictionary: &lt;revolute&gt; or &lt;prismatic&gt; -&gt; closing direction.</span>

                <span class="n">gripper_joints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">extra[@type=&quot;manipulator&quot;]/</span><span class="si">{ns}</span><span class="s1">technique[@profile=&quot;OpenRAVE&quot;]/</span><span class="si">{ns}</span><span class="s1">gripper_joint&#39;</span><span class="p">,</span>
                    <span class="n">root</span><span class="o">=</span><span class="n">AS_motion</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">gj</span> <span class="ow">in</span> <span class="n">gripper_joints</span><span class="p">:</span>
                    <span class="p">[</span><span class="nb">id</span><span class="p">,</span> <span class="n">sid</span><span class="p">]</span> <span class="o">=</span> <span class="n">gj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;joint&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
                    <span class="n">joint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getID</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">KINEMATICS_MODEL_SID</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">sid</span><span class="o">=</span><span class="n">sid</span><span class="p">))</span>

                    <span class="c1"># dictionary: &lt;revolute&gt; or &lt;prismatic&gt; -&gt; closing direction.</span>
                    <span class="n">ga</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">JOINT_SID</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">joint</span><span class="p">,</span> <span class="n">sid</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;axis&#39;</span><span class="p">)):</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gj</span><span class="o">.</span><span class="n">getchildren</span><span class="p">()}</span>
                    <span class="n">gripper_axes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ga</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Failed to load OpenRAVE tags&#39;</span><span class="p">)</span>

            <span class="c1"># Dictionary in which the mesh -&gt; joint relation is stored:</span>
            <span class="n">meshes</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># Now we start to recursively parse the kinematics model and</span>
            <span class="c1"># fetch the information for each joint.</span>
            <span class="k">def</span> <span class="nf">parseLink</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">armature_</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
                <span class="n">space</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span> <span class="o">*</span> <span class="n">depth</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">Link: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sid&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">link</span> <span class="o">==</span> <span class="n">frame_origin</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">Frame origin&#39;</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>
                    <span class="n">armature_</span><span class="o">.</span><span class="n">frame_origin</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="n">link</span> <span class="o">==</span> <span class="n">frame_tip</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">Frame tip&#39;</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>
                    <span class="n">armature_</span><span class="o">.</span><span class="n">frame_tip</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">for</span> <span class="n">attachment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">attachment_full&#39;</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">warning</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="n">attachment</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;joint&#39;</span><span class="p">))</span>

                    <span class="p">[</span><span class="nb">id</span><span class="p">,</span> <span class="n">sid</span><span class="p">]</span> <span class="o">=</span> <span class="n">attachment</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;joint&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
                    <span class="n">instance_joint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">KINEMATICS_MODEL_SID</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">sid</span><span class="o">=</span><span class="n">sid</span><span class="p">)</span>
                    <span class="n">joint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">JOINT_ID</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getID</span><span class="p">(</span><span class="n">instance_joint</span><span class="p">))</span>

                    <span class="n">armatureJoint</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="n">joint</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_Joint&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_joint&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                    <span class="n">armature_</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span><span class="n">armatureJoint</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">attachment</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;link&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="k">break</span>
                        <span class="n">armatureJoint</span><span class="o">.</span><span class="n">addTrafo</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()])</span>

                    <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">joint</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;*[@sid]&#39;</span><span class="p">):</span>  <span class="c1"># TODO We limit ourselves to one axis per joint!</span>
                        <span class="n">armatureJoint</span><span class="o">.</span><span class="n">axis_type</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="n">armatureJoint</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">Axis: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="n">axis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sid&#39;</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">gripper_axes</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">Gripper Joint: Closing direction: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="n">gripper_axes</span><span class="p">[</span><span class="n">axis</span><span class="p">])</span>
                            <span class="n">armatureJoint</span><span class="o">.</span><span class="n">isGripper</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="n">armatureJoint</span><span class="o">.</span><span class="n">closingDirection</span> <span class="o">=</span> <span class="n">gripper_axes</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>

                        <span class="c1"># Where is the axis referred to in &lt;articulated_system&gt;/&lt;kinematics&gt;</span>
                        <span class="n">sidref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findByText</span><span class="p">(</span>
                            <span class="n">COLLADA</span><span class="o">.</span><span class="n">ARTICULATED_SYSTEMS_KINEMATICS_ID</span> <span class="o">+</span> <span class="s1">&#39;//</span><span class="si">{ns}</span><span class="s1">SIDREF&#39;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">makeSIDREF</span><span class="p">(</span><span class="n">AS_kinematics</span><span class="p">,</span> <span class="n">instance_kinematics_model</span><span class="p">,</span>
                                            <span class="n">instance_joint</span><span class="p">,</span> <span class="n">axis</span><span class="p">),</span>
                            <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getID</span><span class="p">(</span><span class="n">instance_AS_kinematics</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">newparam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getParent</span><span class="p">(</span><span class="n">sidref</span><span class="p">)</span>
                        <span class="c1"># Where is the axis referred to in &lt;articulated_system&gt;/&lt;motion&gt;</span>
                        <span class="n">sidref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findByText</span><span class="p">(</span>
                            <span class="n">COLLADA</span><span class="o">.</span><span class="n">ARTICULATED_SYSTEMS_MOTION_ID</span> <span class="o">+</span> <span class="s1">&#39;//</span><span class="si">{ns}</span><span class="s1">SIDREF&#39;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">makeSIDREF</span><span class="p">(</span><span class="n">AS_kinematics</span><span class="p">,</span> <span class="n">newparam</span><span class="p">),</span>
                            <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getID</span><span class="p">(</span><span class="n">instance_AS_motion</span><span class="p">))</span>
                        <span class="n">newparam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getParent</span><span class="p">(</span><span class="n">sidref</span><span class="p">)</span>

                        <span class="c1"># Where is the axis referred to in &lt;kinematic_scene&gt;</span>
                        <span class="n">param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">KINEMATICS_SCENES_ID</span> <span class="o">+</span> <span class="s1">&#39;//</span><span class="si">{ns}</span><span class="s1">param[@ref=&quot;</span><span class="si">{ref}</span><span class="s1">&quot;]&#39;</span><span class="p">,</span>
                                          <span class="n">ref</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">makeSIDREF</span><span class="p">(</span><span class="n">AS_motion</span><span class="p">,</span> <span class="n">newparam</span><span class="p">),</span>
                                          <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getID</span><span class="p">(</span><span class="n">instance_kinematics_scene</span><span class="p">))</span>
                        <span class="n">bind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getParent</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
                        <span class="c1"># Where is the axis referred to in &lt;scene&gt;</span>
                        <span class="n">param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findByText</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">SCENE_INSTANCE_KINEMATICS_SCENE</span> <span class="o">+</span> <span class="s1">&#39;//</span><span class="si">{ns}</span><span class="s1">param&#39;</span><span class="p">,</span>
                                                <span class="n">bind</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;symbol&#39;</span><span class="p">))</span>
                        <span class="n">bind_joint_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getParent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getParent</span><span class="p">(</span><span class="n">param</span><span class="p">))</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">Binding to node: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="n">bind_joint_axis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">))</span>

                        <span class="c1"># Find the connected meshes (it is an optional parameter!)</span>
                        <span class="k">if</span> <span class="n">bind_joint_axis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">):</span>
                            <span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="n">trafo</span><span class="p">]</span> <span class="o">=</span> <span class="n">bind_joint_axis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
                            <span class="n">trafo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">VISUAL_SCENE_2SID</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">visual_scene</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span>
                                              <span class="n">sid</span><span class="o">=</span><span class="n">node</span><span class="p">,</span> <span class="n">sid2</span><span class="o">=</span><span class="n">trafo</span><span class="p">)</span>
                            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getParent</span><span class="p">(</span><span class="n">trafo</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">geometry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.//</span><span class="si">{ns}</span><span class="s1">instance_geometry&#39;</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">node</span><span class="p">):</span>
                                <span class="n">meshes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getID</span><span class="p">(</span><span class="n">geometry</span><span class="p">)]</span> <span class="o">=</span> <span class="n">joint</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

                        <span class="c1"># Now, let&#39;s get the initial joint value (all the way back)</span>
                        <span class="n">symbol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">value/</span><span class="si">{ns}</span><span class="s1">param&#39;</span><span class="p">,</span> <span class="n">bind_joint_axis</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="n">param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">KINEMATICS_SCENES_SYMBOL</span> <span class="o">+</span> <span class="s1">&#39;/</span><span class="si">{ns}</span><span class="s1">param&#39;</span><span class="p">,</span>
                                          <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getID</span><span class="p">(</span><span class="n">instance_kinematics_scene</span><span class="p">),</span> <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span>
                        <span class="p">[</span><span class="nb">id</span><span class="p">,</span> <span class="n">sid</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
                        <span class="n">newparam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">ARTICULATED_SYSTEMS_MOTION_SID</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">sid</span><span class="o">=</span><span class="n">sid</span><span class="p">)</span>
                        <span class="p">[</span><span class="nb">id</span><span class="p">,</span> <span class="n">sid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">SIDREF&#39;</span><span class="p">,</span> <span class="n">newparam</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
                        <span class="n">newparam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">COLLADA</span><span class="o">.</span><span class="n">ARTICULATED_SYSTEMS_KINEMATICS_SID</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">sid</span><span class="o">=</span><span class="n">sid</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">Initial value:</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="n">newparam</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                        <span class="n">armatureJoint</span><span class="o">.</span><span class="n">initialValue</span> <span class="o">=</span> <span class="n">newparam</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>

                        <span class="c1"># it should be easier to obtain the &lt;axis_info&gt;</span>
                        <span class="n">axis_info_kinematics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                            <span class="n">COLLADA</span><span class="o">.</span><span class="n">ARTICULATED_SYSTEMS_KINEMATICS_AXIS_INFO</span><span class="p">,</span>
                            <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getID</span><span class="p">(</span><span class="n">instance_AS_kinematics</span><span class="p">),</span>
                            <span class="n">axis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">makeSIDREF</span><span class="p">(</span><span class="n">kinematics_model</span><span class="p">,</span> <span class="n">instance_joint</span><span class="p">,</span> <span class="n">axis</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">active: </span><span class="si">%s</span><span class="s1">, locked: </span><span class="si">%s</span><span class="s1">, min: </span><span class="si">%s</span><span class="s1">, max: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span>
                                          <span class="n">axis_info_kinematics</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">axis_info_kinematics</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                                          <span class="n">axis_info_kinematics</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                                          <span class="n">axis_info_kinematics</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                        <span class="n">armatureJoint</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">axis_info_kinematics</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
                        <span class="n">armatureJoint</span><span class="o">.</span><span class="n">locked</span> <span class="o">=</span> <span class="n">axis_info_kinematics</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
                        <span class="n">armatureJoint</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">axis_info_kinematics</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                        <span class="n">armatureJoint</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">axis_info_kinematics</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

                        <span class="n">axis_info_motion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                            <span class="n">COLLADA</span><span class="o">.</span><span class="n">ARTICULATED_SYSTEMS_MOTION_AXIS_INFO</span><span class="p">,</span>
                            <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getID</span><span class="p">(</span><span class="n">instance_AS_motion</span><span class="p">),</span>
                            <span class="n">axis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">makeSIDREF</span><span class="p">(</span><span class="n">AS_kinematics</span><span class="p">,</span> <span class="n">axis_info_kinematics</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">speed: </span><span class="si">%s</span><span class="s1">, acceleration: </span><span class="si">%s</span><span class="s1">, deceleration: </span><span class="si">%s</span><span class="s1">, jerk: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span>
                                          <span class="n">axis_info_motion</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">axis_info_motion</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                                          <span class="n">axis_info_motion</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                                          <span class="n">axis_info_motion</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                        <span class="n">armatureJoint</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">axis_info_motion</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                        <span class="n">armatureJoint</span><span class="o">.</span><span class="n">acceleration</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">axis_info_motion</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                        <span class="n">armatureJoint</span><span class="o">.</span><span class="n">deceleration</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">axis_info_motion</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                        <span class="n">armatureJoint</span><span class="o">.</span><span class="n">jerk</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">axis_info_motion</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

                    <span class="n">nextLink</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">link&#39;</span><span class="p">,</span> <span class="n">attachment</span><span class="p">)</span>

                    <span class="n">parseLink</span><span class="p">(</span><span class="n">nextLink</span><span class="p">,</span> <span class="n">armatureJoint</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">technique_common/</span><span class="si">{ns}</span><span class="s1">link&#39;</span><span class="p">,</span> <span class="n">kinematics_model</span><span class="p">):</span>
                <span class="n">parseLink</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">armature</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Meshes:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">meshes</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">armature</span><span class="p">,</span> <span class="n">meshes</span></div>

<div class="viewcode-block" id="COLLADA.addMassObject"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.COLLADA.addMassObject">[docs]</a>    <span class="k">def</span> <span class="nf">addMassObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">transformations</span><span class="p">,</span> <span class="n">inertia</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">collisionModels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">collisionModelTransformations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Incrementally learns the **previously** set training data.</span>

<span class="sd">        :param name: Name of the mass object</span>
<span class="sd">        :type name: string</span>
<span class="sd">        :param transformations: List of transformations to the local coordinate frame.</span>
<span class="sd">        :type transformations: list of tuples (with 3 or 4 elements each,</span>
<span class="sd">        representing translations and rotations respectively)</span>
<span class="sd">        :param inertia: The diagonal elements of the inertia tensor (note that it has to be axis aligned to the local</span>
<span class="sd">        coordinate frame)</span>
<span class="sd">        :type inertia: tuple or list with three elements</span>
<span class="sd">        :param mass: mass of the object</span>
<span class="sd">        :type mass: scalar</span>
<span class="sd">        :param collisionModels: names of the collision models</span>
<span class="sd">        :type collisionModels: list of strings</span>
<span class="sd">        :param collisionModelTransformations: Transformations of the collision models</span>
<span class="sd">        :type collisionModelTransformations: dictionary relating strings to list of transformations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">collisionModels</span><span class="p">:</span>
            <span class="n">collisionModels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">collisionModelTransformations</span><span class="p">:</span>
            <span class="n">collisionModelTransformations</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">rigid_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">physics_model</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">rigid_body&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_rigid_body&#39;</span><span class="p">})</span>
        <span class="n">tc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">rigid_body</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">technique_common&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;mass&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mass</span><span class="p">)</span>
        <span class="n">mass_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">mass_frame&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">transformations</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">mass_frame</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">translate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">t</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">mass_frame</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">rotate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">t</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">inertia&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;inertia&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inertia</span><span class="p">)</span>

        <span class="n">instance_rigid_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance_physics_model</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">instance_rigid_body&#39;</span><span class="p">,</span>
                                              <span class="p">{</span><span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span>
                                               <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">physics_model</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">rigid_body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sid&#39;</span><span class="p">)})</span>

        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">collisionModels</span><span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">rigid_body</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">shape&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">instance_geometry&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="n">model</span><span class="p">})</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">collisionModelTransformations</span><span class="p">[</span><span class="n">model</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">translate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">t</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{ns}</span><span class="s1">rotate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">t</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Tree"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.Tree">[docs]</a><span class="k">class</span> <span class="nc">Tree</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;armature&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Trees! check   check</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>  <span class="c1"># check  check</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformations</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># check    check</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_origin</span> <span class="o">=</span> <span class="s1">&#39;False&#39;</span>  <span class="c1"># check check</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_tip</span> <span class="o">=</span> <span class="s1">&#39;False&#39;</span>  <span class="c1"># check check</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meshes</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># check? format unclear</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markers</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># check? format unclear</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># not yet in the GUI/boneproperty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acceleration</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># not yet in the GUI/boneproperty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deceleration</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># not yet in the GUI/boneproperty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jerk</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># not yet in the GUI/boneproperty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># check check</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># check check</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="s1">&#39;True&#39;</span>  <span class="c1"># not yet in the GUI/boneproperty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locked</span> <span class="o">=</span> <span class="s1">&#39;False&#39;</span>  <span class="c1"># not yet in the GUI/boneproperty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialValue</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># check check</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_type</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># check check</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># check</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isGripper</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># check check</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closingDirection</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># check check</span>

<div class="viewcode-block" id="Tree.addTrafo"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.Tree.addTrafo">[docs]</a>    <span class="k">def</span> <span class="nf">addTrafo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trafo</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trafo</span><span class="p">)</span></div>

<div class="viewcode-block" id="Tree.addChild"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.Tree.addChild">[docs]</a>    <span class="k">def</span> <span class="nf">addChild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t</span></div>

<div class="viewcode-block" id="Tree.traverse"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.Tree.traverse">[docs]</a>    <span class="k">def</span> <span class="nf">traverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">pass</span>
            <span class="n">c</span><span class="o">.</span><span class="n">traverse</span><span class="p">()</span></div>

<div class="viewcode-block" id="Tree.connectMarkers"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.Tree.connectMarkers">[docs]</a>    <span class="k">def</span> <span class="nf">connectMarkers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">markers</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;markers dictionary, marker_name -&gt; tupel(joint name, relative position)&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Tree.connectMeshes"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.Tree.connectMeshes">[docs]</a>    <span class="k">def</span> <span class="nf">connectMeshes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meshes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meshes</span> <span class="o">=</span> <span class="p">[</span><span class="n">mesh</span> <span class="k">for</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">joint</span> <span class="ow">in</span> <span class="n">meshes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">joint</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">connectMeshes</span><span class="p">(</span><span class="n">meshes</span><span class="p">)</span></div>

<div class="viewcode-block" id="Tree.compare"><a class="viewcode-back" href="../../../../apidoc/robot_designer_plugin.export.collada15.collada.html#robot_designer_plugin.export.collada15.collada.Tree.compare">[docs]</a>    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">marker</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v1</span> <span class="o">==</span> <span class="n">v2</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="s1">&#39;(OK)&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="s1">&#39;(Failed)&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">marker</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">depth</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">v1</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">v2</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">v1</span><span class="p">)),</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">v1</span><span class="p">)),</span> <span class="nb">str</span><span class="p">(</span><span class="n">match</span><span class="p">)))</span>

        <span class="n">check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformations</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">transformations</span><span class="p">),</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="c1"># print(str(self.transformations[0]))</span>
        <span class="n">check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_origin</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">frame_origin</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_tip</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">frame_tip</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acceleration</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">acceleration</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deceleration</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">deceleration</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jerk</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">jerk</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">active</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locked</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">locked</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initialValue</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">initialValue</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_type</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">axis_type</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isGripper</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">isGripper</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">closingDirection</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">closingDirection</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">children</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">children</span><span class="p">):</span>
            <span class="n">c1</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></div>

    <span class="c1"># Then traverse the tree</span>
    <span class="k">pass</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">collada</span> <span class="o">=</span> <span class="n">COLLADA</span><span class="p">()</span>
    <span class="n">collada</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;virtual_armar3b_new_helmet.dae&#39;</span><span class="p">)</span>
    <span class="n">tree</span><span class="p">,</span> <span class="n">meshes</span> <span class="o">=</span> <span class="n">collada</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>

    <span class="c1"># This must be read from the old file!</span>
    <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">collada</span> <span class="o">=</span> <span class="n">COLLADA</span><span class="p">()</span>
        <span class="n">collada</span><span class="o">.</span><span class="n">import14</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">collada&#39;</span> <span class="o">%</span> <span class="n">collada</span><span class="o">.</span><span class="n">ns</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;1.5&#39;</span><span class="p">})</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">scene&#39;</span> <span class="o">%</span> <span class="n">collada</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="n">collada</span> <span class="o">=</span> <span class="n">COLLADA</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

    <span class="n">collada</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">meshes</span><span class="p">)</span>
    <span class="n">collada</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;test.dae&#39;</span><span class="p">)</span>

    <span class="n">collada</span> <span class="o">=</span> <span class="n">COLLADA</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="n">newtree</span><span class="p">,</span> <span class="n">meshes</span> <span class="o">=</span> <span class="n">collada</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>

    <span class="n">newtree</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

    <span class="k">pass</span>


<span class="c1"># JUNK CODE</span>
<span class="c1">#    def iterJointNodes(self):</span>
<span class="c1">#        return self.iterfind(&quot;.//{ns}node[@type=&#39;JOINT&#39;]&quot;)</span>
<span class="c1">#        # Find a regular Node with id:</span>
<span class="c1">#        #list(root.iterfind(&quot;.//{ns}node[@type=&#39;NODE&#39;][@id=&#39;robot&#39;]&quot;.format(**locals())))</span>
<span class="c1">#</span>
<span class="c1">#    # Replace these functions by strings!</span>
<span class="c1">#</span>
<span class="c1">#    # JOINT or JOINT_SID</span>
<span class="c1">#    def resolveJoint(self,id, sid=None):</span>
<span class="c1">#        # id and sid do NOT need double quotes! e.g.:not &#39;&quot;palm_Joint&quot;&#39; and  &#39;&quot;axis0&quot;&#39;</span>
<span class="c1">#        if sid:</span>
<span class="c1">#            return self.find(&#39;{ns}library_joints/{ns}joint[@id=&quot;{id}&quot;]/*[@sid=&quot;{sid}&quot;]&#39;,id=id,sid=sid)</span>
<span class="c1">#        else:</span>
<span class="c1">#            return self.find(&#39;{ns}library_joints/{ns}joint[@id=&quot;{id}&quot;]&#39;,id=id)</span>
<span class="c1">#</span>
<span class="c1">#    # KINEMATICS_MODEL KINEMATICS_MODEL_SID</span>
<span class="c1">#    def resolveKinematicsModel(self,id,sid=None):</span>
<span class="c1">#        if sid:</span>
<span class="c1">#            return self.find(&#39;{ns}library_kinematics_models/{ns}kinematics_model&#39; +</span>
<span class="c1">#               &#39;[@id=&quot;{id}&quot;]/{ns}technique_common//*[@sid=&quot;{sid}&quot;]&#39;,</span>
<span class="c1">#                id=id,sid=sid)</span>
<span class="c1">#        else:</span>
<span class="c1">#            pass</span>
<span class="c1">#    return self.find(&#39;{ns}library_kinematics_models/{ns}kinematics_model[@id=&quot;{id}&quot;]&#39;,id=id)</span>
</pre></div>
            </div>

            <aside class="hbpdoc-hnav hbpdoc-hnav-bottom">
                
                
            </aside>
        </article>
    </section>


    <div class="hbpdoc-footer">
        NRP RobotDesigner <small>0.1</small> 
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, Stefan Ulbrich (FZI).
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.2.
    </div>
    </div>
</div>

  </body>
</html>