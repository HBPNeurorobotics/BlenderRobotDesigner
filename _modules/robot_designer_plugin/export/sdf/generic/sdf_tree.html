


<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>robot_designer_plugin.export.sdf.generic.sdf_tree &#8212; NRP RobotDesigner 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../../../../_static/hbpdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../../../_static/hbpdoc.js"></script>
    <link rel="shortcut icon" href="../../../../../_static/hbp_32x32.ico"/>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
<meta name="viewport" content="width=device-width, initial-scale=1">

  </head>
  <body>
<div class="hbpdoc-page">
    <section class="hbpdoc-title page-header">
        <a class="project-title" href="../../../../../index.html">NRP RobotDesigner</a>

        <a class="hbpdoc-toc-toggle pull-right" href>
            <span class="zmdi zmdi-menu"></span> <span class="sr-only icon-text">Menu</span>
        </a>
    </section>
    <section class="hbpdoc-main">
        <nav class="hbpdoc-sidebar hbpdoc-container">
            <a class="hbpdoc-toc-toggle pull-right" href>
                <span class="zmdi zmdi-menu"></span> <span class="sr-only icon-text">Menu</span>
            </a>
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
        </nav>

        <article class="hbpdoc-content">

            <div class="content">
                
                <div class="breadcrumb breadcrumb-meta expand">
                    
                    <a href="../../../../index.html">Module code</a>
                    
                    <a href="../../../../robot_designer_plugin.html">robot_designer_plugin</a>
                    
                </div>
                

                <aside class="hbpdoc-hnav hbpdoc-hnav-top">
                    
                    
                </aside>

                <h1>Source code for robot_designer_plugin.export.sdf.generic.sdf_tree</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">pyxb</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">sdf_dom</span>
<span class="kn">from</span> <span class="nn">.helpers</span> <span class="k">import</span> <span class="n">list_to_string</span>
<span class="kn">from</span> <span class="nn">pyxb</span> <span class="k">import</span> <span class="n">ContentNondeterminismExceededError</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;SDF&#39;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="c1">#~/Documents/blender-2.78-d35bf3f-linux-glibc219-x86_64/2.78/python/bin/pyxbgen -u sdf_model.xsd -m sdf_model_dom</span>

<div class="viewcode-block" id="set_value"><a class="viewcode-back" href="../../../../../apidoc/robot_designer_plugin.export.sdf.generic.sdf_tree.html#robot_designer_plugin.export.sdf.generic.sdf_tree.set_value">[docs]</a><span class="k">def</span> <span class="nf">set_value</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    helper function that creates a string out of a list of floats</span>
<span class="sd">    :param l: python list of floats</span>
<span class="sd">    :return: string representing the list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l</span><span class="p">)</span></div>


<div class="viewcode-block" id="SDFTree"><a class="viewcode-back" href="../../../../../apidoc/robot_designer_plugin.export.sdf.generic.sdf_tree.html#robot_designer_plugin.export.sdf.generic.sdf_tree.SDFTree">[docs]</a><span class="k">class</span> <span class="nc">SDFTree</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class that parses and represents a robot described by a SDF file.</span>
<span class="sd">    The data is stored in a tree of linked instances of this class. Therefore, a root element (or several) has to be</span>
<span class="sd">    detectable in the file excluding closed kinematic loops at the moment.</span>
<span class="sd">    Each instance represents a *blender/RobotDesigner bone* that is a compound of joint and link.</span>
<span class="sd">    It uses a document object model (DOM) created by pyxbgen.py (in version 1.2.5 -- pyxb).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connected_joints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">connected_links</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">robot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Constructor</span>
<span class="sd">        :param root: if specified, the constructor copies the cross-references in the XML file from another</span>
<span class="sd">        SDFTree instance.</span>
<span class="sd">        :param connected_joints: If specified, the connectedJoints (cross-reference in the XML file) is set.</span>
<span class="sd">        :param connected_links: If specified, the connectedLinks (cross-reference in the XML file) is set.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">robot</span> <span class="o">=</span> <span class="n">robot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sdf</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connectedLinks</span> <span class="o">=</span> <span class="n">connected_links</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connectedJoints</span> <span class="o">=</span> <span class="n">connected_joints</span>

<div class="viewcode-block" id="SDFTree.parse"><a class="viewcode-back" href="../../../../../apidoc/robot_designer_plugin.export.sdf.generic.sdf_tree.html#robot_designer_plugin.export.sdf.generic.sdf_tree.SDFTree.parse">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Parses a SDF file and builds up a tree representing the kinematic structure of a robot.</span>
<span class="sd">        Explanation: The SDF file format stores links (i.e., rigid bodies) and joints (i.e., connection between links)</span>
<span class="sd">        in a flat structure (as opposed to a tree data structure). Links have no references while joints refer to the</span>
<span class="sd">        NAMES of have exactly one parent (link) and child (link). This method first resolves these cross references</span>
<span class="sd">        and calls the recursive SDFTree.build() method to create a tree-like data structure representing the</span>
<span class="sd">        kinematic tree(s) of the robot.</span>
<span class="sd">        :param file_name: the name of the file to open</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># read the file</span>
        <span class="c1"># robot = sdf_model_dom.parse(file_name, silence=True)</span>
        <span class="c1"># to add the root link to the kinematic chain, we create a virtual link on top of the root link. (temporal solution)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">sdf_dom</span><span class="o">.</span><span class="n">CreateFromDocument</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="k">except</span> <span class="n">ContentNondeterminismExceededError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error raised </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="n">robot</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The name of the robot &#39;</span><span class="p">,</span> <span class="n">robot</span><span class="p">)</span>

        <span class="c1"># create mapping from (parent) links to joints  (a list)</span>
        <span class="n">connected_joints</span> <span class="o">=</span> <span class="p">{</span><span class="n">link</span><span class="p">:</span> <span class="p">[</span><span class="n">joint</span> <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="n">robot</span><span class="o">.</span><span class="n">joint</span> <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">joint</span><span class="o">.</span><span class="n">parent</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">link</span>
                            <span class="ow">in</span> <span class="n">robot</span><span class="o">.</span><span class="n">link</span><span class="p">}</span>

        <span class="c1"># create mapping from joints to their child links (a dictionary)</span>
        <span class="n">connected_links</span> <span class="o">=</span> <span class="p">{</span><span class="n">joint</span><span class="p">:</span> <span class="n">link</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">robot</span><span class="o">.</span><span class="n">link</span> <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="n">robot</span><span class="o">.</span><span class="n">joint</span> <span class="k">if</span>
                           <span class="n">link</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">joint</span><span class="o">.</span><span class="n">child</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span>

        <span class="c1"># find root links (i.e., links that are NOT connected to a joint)</span>
        <span class="n">child_links</span> <span class="o">=</span> <span class="p">[</span><span class="n">link</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">robot</span><span class="o">.</span><span class="n">link</span> <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="n">robot</span><span class="o">.</span><span class="n">joint</span> <span class="k">if</span>
                       <span class="n">link</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">joint</span><span class="o">.</span><span class="n">child</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="c1">###  the link, not link name</span>
        <span class="n">root_links</span> <span class="o">=</span> <span class="p">[</span><span class="n">link</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">robot</span><span class="o">.</span><span class="n">link</span> <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">child_links</span><span class="p">]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Root links: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">root_links</span><span class="p">])</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;connected links: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">j</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">l</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">connected_links</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>

        <span class="n">kinematic_chains</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Skips the basis links</span>
        <span class="c1"># for link in root_links:</span>
        <span class="c1">#     for joint in connected_joints[link]:</span>
        <span class="c1">#         tree = SDFTree(connected_links=connected_links, connected_joints=connected_joints, robot=robot)</span>
        <span class="c1">#         #print({j.name: l.name for j, l in tree.connectedLinks.items()})</span>
        <span class="c1">#         #print(tree.joint, tree.link)</span>
        <span class="c1">#         kinematic_chains.append(tree)</span>
        <span class="c1">#         tree.build(connected_links[joint], joint)</span>
        <span class="c1">#</span>
        <span class="c1">#         # todo: parse joint controllers</span>
        <span class="c1"># todo: here we assume that root link has only one child link</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">root_links</span><span class="p">:</span>
            <span class="c1">#for joint in connected_joints[link]:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">SDFTree</span><span class="p">(</span><span class="n">connected_links</span><span class="o">=</span><span class="n">connected_links</span><span class="p">,</span> <span class="n">connected_joints</span><span class="o">=</span><span class="n">connected_joints</span><span class="p">,</span> <span class="n">robot</span><span class="o">=</span><span class="n">robot</span><span class="p">)</span>
                <span class="c1">#print({j.name: l.name for j, l in tree.connectedLinks.items()})</span>
                <span class="c1">#print(tree.joint, tree.link)</span>
            <span class="n">kinematic_chains</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

                <span class="c1"># todo: parse joint controllers</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;kinematic chains: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">kinematic_chains</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">robot</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">root_links</span><span class="p">,</span> <span class="n">kinematic_chains</span><span class="c1">#, controller_cache, gazebo_tags</span></div>

<div class="viewcode-block" id="SDFTree.build"><a class="viewcode-back" href="../../../../../apidoc/robot_designer_plugin.export.sdf.generic.sdf_tree.html#robot_designer_plugin.export.sdf.generic.sdf_tree.SDFTree.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">joint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursive function that builds up the tree representation of the robot. You do not have to call it manually (</span>
<span class="sd">        Called by parse).</span>
<span class="sd">        :param link: The link the kinematics subtree starts with</span>
<span class="sd">        :param joint: The joint connecting to the previous link (if any)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint</span> <span class="o">=</span> <span class="n">joint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">link</span>
        <span class="c1">#self.set_defaults() # todo:set defaults</span>

        <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectedJoints</span><span class="p">[</span><span class="n">link</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">SDFTree</span><span class="p">(</span><span class="n">connected_links</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">connectedLinks</span><span class="p">,</span> <span class="n">connected_joints</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">connectedJoints</span><span class="p">,</span>
                            <span class="n">robot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectedLinks</span><span class="p">[</span><span class="n">joint</span><span class="p">],</span> <span class="n">joint</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="SDFTree.create_empty"><a class="viewcode-back" href="../../../../../apidoc/robot_designer_plugin.export.sdf.generic.sdf_tree.html#robot_designer_plugin.export.sdf.generic.sdf_tree.SDFTree.create_empty">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_empty</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an empty tree object.</span>

<span class="sd">        :param name: the name of the robot the tree is representing the model of.</span>
<span class="sd">        :type name: string</span>
<span class="sd">        :return: The tree instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sdf</span> <span class="o">=</span> <span class="n">sdf_dom</span><span class="o">.</span><span class="n">sdf</span><span class="p">()</span>
        <span class="n">sdf</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;1.5&#39;</span>
        <span class="n">pyxb</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">domutils</span><span class="o">.</span><span class="n">BindingDOMSupport</span><span class="o">.</span><span class="n">SetDefaultNamespace</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">sdf</span><span class="o">.</span><span class="n">model</span><span class="p">:</span>
            <span class="n">sdf</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sdf_dom</span><span class="o">.</span><span class="n">model</span><span class="p">())</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">SDFTree</span><span class="p">(</span><span class="n">connected_links</span><span class="o">=</span><span class="p">{},</span> <span class="n">connected_joints</span><span class="o">=</span><span class="p">{},</span> <span class="n">robot</span><span class="o">=</span><span class="n">sdf</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">sdf</span> <span class="o">=</span> <span class="n">sdf</span>

        <span class="n">tree</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">sdf_dom</span><span class="o">.</span><span class="n">link</span><span class="p">()</span>

        <span class="c1">#tree.set_defaults() # todo set defaults</span>

        <span class="c1"># build empty gazebo tag for control plugins</span>
        <span class="c1">#tree.gazebo_tag = urdf_dom.GazeboType()</span>
        <span class="c1">#tree.robot.gazebo.append(tree.gazebo_tag)</span>

        <span class="k">return</span> <span class="n">tree</span></div>

<div class="viewcode-block" id="SDFTree.write"><a class="viewcode-back" href="../../../../../apidoc/robot_designer_plugin.export.sdf.generic.sdf_tree.html#robot_designer_plugin.export.sdf.generic.sdf_tree.SDFTree.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Should only be called on the root element.</span>
<span class="sd">        :param file_name:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;connected joints: &quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">j</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">l</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectedJoints</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;connected links: &quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">j</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">l</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectedLinks</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;root link name: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>


        <span class="k">for</span> <span class="n">joint</span><span class="p">,</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectedLinks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">joint</span><span class="o">.</span><span class="n">child</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">link</span><span class="p">,</span> <span class="n">joints</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectedJoints</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="n">joints</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;connected link name:&quot;</span><span class="p">,</span> <span class="n">link</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;connected link linked joint name: &quot;</span><span class="p">,</span> <span class="n">joint</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">joint</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># # Connect root joints to self.link (the root link)</span>
        <span class="c1"># for joint in self.robot.joint:</span>
        <span class="c1">#     print(&quot;robot joint name: &quot;, joint.name)</span>
        <span class="c1">#</span>
        <span class="c1">#     if joint.parent is None:</span>
        <span class="c1">#         joint.parent = self.link.name</span>

        <span class="c1"># self.connectedLinks = {key: value for key, value in self.sdf.model[0].items() if key.name != &#39;rd_virtual_joint&#39;}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sdf</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">joint</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sdf</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">joint</span> <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">parent</span><span class="p">]</span>
        <span class="c1"># for j in self.sdf.model[0].joint:</span>
        <span class="c1">#</span>
        <span class="c1">#     print(j.name)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_name</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1"># f.write(&#39;&lt;?xml version=&quot;1.0&quot; ?&gt;&#39;)</span>

            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sdf</span><span class="o">.</span><span class="n">toDOM</span><span class="p">()</span><span class="o">.</span><span class="n">toprettyxml</span><span class="p">()</span>
            <span class="c1"># output = self.sdf.toprettyxml()</span>
            <span class="c1"># output = self.sdf.toxml(&quot;utf-8&quot;, element_name=&quot;sdf&quot;).decode(&quot;utf-8&quot;)</span>
            <span class="c1">#output = output.replace(&quot;&gt;&quot;, &quot;&gt;\n&quot;)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span><span class="p">)</span></div>
            <span class="c1"># self.robot.export(f,0)</span>


    <span class="k">def</span> <span class="nf">_write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursion that builds the creates the cross links for the DOM (might not be necessary)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="SDFTree.add"><a class="viewcode-back" href="../../../../../apidoc/robot_designer_plugin.export.sdf.generic.sdf_tree.html#robot_designer_plugin.export.sdf.generic.sdf_tree.SDFTree.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates and adds another SDFTree instance to this node. Do not add children to the subtree manually as</span>
<span class="sd">        references are not created then. Note that if there is no robot member defined yet (i.e., you are *exporting*),</span>
<span class="sd">        it will be created automatically.</span>
<span class="sd">        :param link: a sdf_dom link element</span>
<span class="sd">        :param joint: a sdf_dom joint element</span>
<span class="sd">        :return: a reference to the newly created SDFTree instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tree</span> <span class="o">=</span> <span class="n">SDFTree</span><span class="p">(</span><span class="n">connected_links</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">connectedLinks</span><span class="p">,</span> <span class="n">connected_joints</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">connectedJoints</span><span class="p">,</span> <span class="n">robot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">)</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">joint</span> <span class="o">=</span> <span class="n">sdf_dom</span><span class="o">.</span><span class="n">joint</span><span class="p">()</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">sdf_dom</span><span class="o">.</span><span class="n">link</span><span class="p">()</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">link</span><span class="p">)</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">joint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">joint</span><span class="p">)</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">()</span>


        <span class="c1"># self.connectedLinks[tree.joint] = tree.link</span>
        <span class="c1"># if self.link in self.connectedJoints:</span>
        <span class="c1">#     self.connectedJoints[self.link].append(tree.joint)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     self.connectedJoints[self.link] = [tree.joint]</span>

        <span class="c1"># e.g., virtual joint --&gt; base link</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connectedLinks</span><span class="p">[</span><span class="n">tree</span><span class="o">.</span><span class="n">joint</span><span class="p">]</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">link</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;connected links (joint-&gt;link): &quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">j</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">l</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectedLinks</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>

        <span class="c1"># if self.link not in self.connectedJoints:</span>
        <span class="c1">#     self.connectedJoints[self.link] = []</span>

        <span class="c1"># for j, l in self.connectedJoints.items():</span>
        <span class="c1">#     if j.name == tree.joint.:</span>
        <span class="c1">#         self.connectedJoints[j].append(tree.joint)</span>
        <span class="c1">#</span>
        <span class="c1">#     print(&quot;connected joints: &quot;, {j.name: l for j, l in connected_joints.items()})</span>


        <span class="c1">#</span>
        <span class="c1"># if self.link in self.connectedJoints:</span>
        <span class="c1">#     self.connectedJoints[self.link].append(tree.link)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     self.connectedJoints[self.link] = [tree.link]</span>

        <span class="k">return</span> <span class="n">tree</span></div>

<div class="viewcode-block" id="SDFTree.add_mesh"><a class="viewcode-back" href="../../../../../apidoc/robot_designer_plugin.export.sdf.generic.sdf_tree.html#robot_designer_plugin.export.sdf.generic.sdf_tree.SDFTree.add_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">add_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a mesh to current segment.</span>

<span class="sd">        :param file_name: Name of the file</span>
<span class="sd">        :type file_name: string</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">link_visual</span> <span class="o">=</span> <span class="n">sdf_dom</span><span class="o">.</span><span class="n">visual</span><span class="p">()</span><span class="c1">#CTD_ANON_97()   # CTD_ANON_60_visual  CTD_ANON_97--sdf</span>
        <span class="n">link_geometry</span> <span class="o">=</span> <span class="n">sdf_dom</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>  <span class="c1">#CTD_ANON_17()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">visual</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link_visual</span><span class="p">)</span>
        <span class="n">link_visual</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link_geometry</span><span class="p">)</span> <span class="c1">#sdf_dom.CTD_ANON_97.geometry()</span>
        <span class="c1"># visual. = sdf_dom.CTD_ANON_96.pose()</span>
        <span class="n">link_visual</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sdf_dom</span><span class="o">.</span><span class="n">mesh</span><span class="p">())</span>
        <span class="n">link_visual</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mesh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">uri</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="c1"># link_visual.geometry[0].mesh[0].scale.append(sdf_dom.CTD_ANON_68().scale()  #list_to_string(scale_factor)</span>
        <span class="n">link_visual</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mesh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_to_string</span><span class="p">(</span><span class="n">scale_factor</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">link_visual</span></div>

<div class="viewcode-block" id="SDFTree.add_collision"><a class="viewcode-back" href="../../../../../apidoc/robot_designer_plugin.export.sdf.generic.sdf_tree.html#robot_designer_plugin.export.sdf.generic.sdf_tree.SDFTree.add_collision">[docs]</a>    <span class="k">def</span> <span class="nf">add_collision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a collision model to a mesh object</span>

<span class="sd">        :param   file_name:  name of the mesh object for which the col_model is generated</span>
<span class="sd">        :type    file_name:  string</span>
<span class="sd">        :return: string:     Collision file that is used in the sdf</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">link_collision</span> <span class="o">=</span> <span class="n">sdf_dom</span><span class="o">.</span><span class="n">collision</span><span class="p">()</span><span class="c1">#CTD_ANON_15()</span>
        <span class="n">link_geometry</span> <span class="o">=</span> <span class="n">sdf_dom</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">collision</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link_collision</span><span class="p">)</span>
        <span class="n">link_collision</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link_geometry</span><span class="p">)</span>

        <span class="n">link_collision</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sdf_dom</span><span class="o">.</span><span class="n">mesh</span><span class="p">())</span>
        <span class="n">link_collision</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mesh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">uri</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>

        <span class="c1"># collision.origin = sdf_dom.CTD_ANON_15.pose()</span>
        <span class="c1"># collision.geometry.mesh = sdf_dom.CTD_ANON_70()</span>
        <span class="c1"># print(&#39;debug add_collisionmodel: &#39; + file_name)</span>
        <span class="c1"># collision.geometry.mesh.filename = file_name</span>
        <span class="n">link_collision</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mesh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_to_string</span><span class="p">(</span><span class="n">scale_factor</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">link_collision</span></div>

<div class="viewcode-block" id="SDFTree.add_inertial"><a class="viewcode-back" href="../../../../../apidoc/robot_designer_plugin.export.sdf.generic.sdf_tree.html#robot_designer_plugin.export.sdf.generic.sdf_tree.SDFTree.add_inertial">[docs]</a>    <span class="k">def</span> <span class="nf">add_inertial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a inertial definition to a link object</span>

<span class="sd">        :return: string:     reference to inertial object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#inertial = sdf_dom.inertial()#CTD_ANON_46()</span>
        <span class="c1">#self.link.inertial.append(inertial)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">inertial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mass</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;1.0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">inertial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;0 0 0 0 0 0&#39;</span><span class="p">)</span>
        <span class="c1"># inertial.mass.value_ = &quot;1.0&quot;</span>
        <span class="c1"># inertial.inertia = sdf_dom.inertia() #CTD_ANON_45()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">inertial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">inertia</span><span class="o">.</span><span class="n">ixx</span> <span class="o">=</span> <span class="s1">&#39;1.0&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">inertial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">inertia</span><span class="o">.</span><span class="n">iyy</span> <span class="o">=</span> <span class="s1">&#39;1.0&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">inertial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">inertia</span><span class="o">.</span><span class="n">izz</span> <span class="o">=</span> <span class="s1">&#39;1.0&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">inertial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">inertia</span><span class="o">.</span><span class="n">ixy</span> <span class="o">=</span> <span class="s1">&#39;0.0&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">inertial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">inertia</span><span class="o">.</span><span class="n">ixz</span> <span class="o">=</span> <span class="s1">&#39;0.0&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">inertial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">inertia</span><span class="o">.</span><span class="n">iyz</span> <span class="o">=</span> <span class="s1">&#39;0.0&#39;</span>


        <span class="c1">#     = inertial.inertia.izz =  inertial.inertia.iyy = &quot;1.0&quot;</span>
        <span class="c1"># inertial.inertia.ixy = inertial.inertia.ixz =  inertial.inertia.iyz = &quot;0.0&quot;</span>
        <span class="c1"># inertial.origin = sdf_dom.CTD_ANON_46.pose()</span>
        <span class="c1"># inertial.origin.xyz = &quot;0 0 0&quot;</span>
        <span class="c1"># inertial.origin.rpy = &quot;0 0 0&quot;</span>

        <span class="c1"># print(&#39;debug add_inertial: &#39;)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">inertial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="c1">#def add_joint_control_plugin(self):</span>
     <span class="c1">#    &quot;&quot;&quot;</span>
     <span class="c1">#    Adds a reference to the generic control plugin of the NRP backend.</span>

     <span class="c1">#   :return: Reference to the plugin type defined in the URDF</span>
     <span class="c1">#   &quot;&quot;&quot;</span>

     <span class="c1">#   plugin = urdf_dom.GazeboPluginType()</span>
     <span class="c1">#   plugin.name = &quot;generic_controller&quot;</span>
     <span class="c1">#   plugin.filename = &quot;libgeneric_controller_plugin.so&quot;</span>
     <span class="c1">#   self.gazebo_tag.plugin.append(plugin)</span>
    <span class="c1">#    return plugin</span>

    <span class="c1">#def add_joint_controller(self, control_plugin):</span>
    <span class="c1">#    &quot;&quot;&quot;</span>
    <span class="c1">#    Add a controller definition to a robot object</span>

    <span class="c1">#    :return: string:     reference to inertial object</span>
    <span class="c1">#    &quot;&quot;&quot;</span>
    <span class="c1">#    joint_controller = urdf_dom.GenericControllerPluginDefType()</span>
    <span class="c1">#    if joint_controller.pid == &quot;1.0 1.0 1.0&quot;:</span>
    <span class="c1">#        joint_controller.pid = &quot;100.0 1.0 1.0&quot;</span>
    <span class="c1">#        print(&quot;Debug: Joint Controller set&quot;)</span>

    <span class="c1">#    control_plugin.append(joint_controller)</span>
    <span class="c1">#    print(&quot;Added joint controller.&quot;)</span>

    <span class="c1">#    return joint_controller</span>

<div class="viewcode-block" id="SDFTree.set_defaults"><a class="viewcode-back" href="../../../../../apidoc/robot_designer_plugin.export.sdf.generic.sdf_tree.html#robot_designer_plugin.export.sdf.generic.sdf_tree.SDFTree.set_defaults">[docs]</a>    <span class="k">def</span> <span class="nf">set_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds defaults to missing values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">joint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint</span>
        <span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">link</span>

        <span class="n">joint</span><span class="o">.</span><span class="n">child</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">joint</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">joint_axis</span> <span class="o">=</span> <span class="n">sdf_dom</span><span class="o">.</span><span class="n">CTD_ANON_47</span><span class="p">()</span>
        <span class="c1"># if not joint_axis.xyz:</span>
        <span class="c1">#     print(vars(joint_axis.xyz))</span>
        <span class="c1">#     joint_axis.xyz.append(&#39;0 0 0 0&#39;)</span>
        <span class="n">joint_axis_limit</span> <span class="o">=</span> <span class="n">sdf_dom</span><span class="o">.</span><span class="n">CTD_ANON_49</span><span class="p">()</span>

        <span class="n">link_inertial</span> <span class="o">=</span> <span class="n">sdf_dom</span><span class="o">.</span><span class="n">inertial</span><span class="p">()</span>
        <span class="n">link_inertial_inertia</span> <span class="o">=</span> <span class="n">sdf_dom</span><span class="o">.</span><span class="n">CTD_ANON_45</span><span class="p">()</span>
        <span class="c1"># joint_axis_xyz = joint_axis.xyz.vector3</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Joint Axis&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">joint</span><span class="o">.</span><span class="n">axis</span><span class="p">:</span>
            <span class="n">joint</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">joint_axis</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">joint</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">limit</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Set defaults: Joint Axis Limit &#39;</span><span class="p">)</span>
            <span class="n">joint</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">limit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">joint_axis_limit</span><span class="p">)</span>
            <span class="c1"># joint.axis[0].limit.append(BIND())</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">link</span><span class="o">.</span><span class="n">inertial</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Set defaults: Joint Axis Limit &#39;</span><span class="p">)</span>
            <span class="n">link</span><span class="o">.</span><span class="n">inertial</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link_inertial</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">link</span><span class="o">.</span><span class="n">inertial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">inertia</span><span class="p">:</span>
            <span class="n">link</span><span class="o">.</span><span class="n">inertial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">inertia</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link_inertial_inertia</span><span class="p">)</span>

        <span class="n">link</span><span class="o">.</span><span class="n">inertial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mass</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;1.0&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">inertial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;0 0 0 0 0 0&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">inertial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">inertia</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ixx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">inertial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">inertia</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">iyy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">inertial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">inertia</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">izz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">inertial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">inertia</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ixy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">inertial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">inertia</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ixz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">inertial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">inertia</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">iyz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span></div>

        <span class="c1"># if not joint.axis[0].xyz:</span>
            <span class="c1"># print(&#39;Set defaults: Joint Axis xyz &#39;)</span>
            <span class="c1"># print(joint.axis[0].xyz)</span>
            <span class="c1"># joint.axis[0].xyz.append(joint_axis_xyz)</span>

        <span class="c1"># if joint.limit is None:</span>
        <span class="c1">#     joint.limit = sdf_dom.CTD_ANON_51()</span>
        <span class="c1">#     # this had to be completely defined (missing effor argument caused conversion to SDF to fail)</span>
        <span class="c1">#     joint.limit.effort = 100.0</span>
        <span class="c1">#     joint.limit.lower = joint.limit.upper = joint.limit.velocity = 1.0</span>
        <span class="c1">#</span>
        <span class="c1"># #if joint.calibration is None:  # todo calibration tag ignored</span>
        <span class="c1"># #    joint.calibration = sdf_model_dom.CalibrationType()</span>
        <span class="c1"># #    joint.calibration.reference_position = 0.0</span>
        <span class="c1"># #    joint.calibration.rising = 0.0  # there are no default values in the XSD?</span>
        <span class="c1"># #    joint.calibration.falling = 0.0</span>
        <span class="c1">#</span>
        <span class="c1"># if joint.origin is None:</span>
        <span class="c1">#     joint.origin = sdf_dom.CTD_ANON_48.pose()</span>
        <span class="c1">#     # joint.rpy =</span>
        <span class="c1">#</span>
        <span class="c1"># for visual in link.visual:</span>
        <span class="c1">#     if visual.origin is None:</span>
        <span class="c1">#         visual.origin = sdf_dom.CTD_ANON_96.pose()</span>
        <span class="c1">#</span>
        <span class="c1"># for collision in link.collision:</span>
        <span class="c1">#     if collision.origin is None:</span>
        <span class="c1">#         collision.origin = sdf_dom.CTD_ANON_15.pose()</span>
        <span class="c1">#</span>
        <span class="c1"># if joint.dynamics is None:</span>
        <span class="c1">#     joint.dynamics = sdf_dom.CTD_ANON_49.dynamics()</span>
        <span class="c1">#     joint.dynamics.damping = 1.0</span>
        <span class="c1">#</span>
        <span class="c1"># if link.pose is None:</span>
        <span class="c1">#     logger.debug(&quot;Link pose is None, creating default one.&quot;)</span>
        <span class="c1">#     link.inertial = sdf_dom.CTD_ANON_58.pose()</span>
        <span class="c1">#</span>
        <span class="c1"># if link.inertial is None:</span>
        <span class="c1">#     logger.debug(&quot;Inertial is None, creating default one.&quot;)</span>
        <span class="c1">#     link.inertial = sdf_dom.CTD_ANON_58.inertial()</span>
        <span class="c1">#</span>
        <span class="c1"># for inertial in link.inertial:</span>
        <span class="c1">#     if inertial.mass is None:</span>
        <span class="c1">#         inertial.mass = sdf_dom.CTD_ANON_46.mass()</span>
        <span class="c1">#     if inertial.inertia is None:</span>
        <span class="c1">#         inertial.inertia = sdf_dom.CTD_ANON_46()</span>

                <span class="c1"># if joint.mimic is None: # truely optional</span>
                <span class="c1"># if joint.safety_controller is None: # ignored</span>

                <span class="c1"># if link.inertial is None:</span>

                <span class="c1"># todo continue and remove if statements from urdf_blender</span>

<div class="viewcode-block" id="SDFTree.show"><a class="viewcode-back" href="../../../../../apidoc/robot_designer_plugin.export.sdf.generic.sdf_tree.html#robot_designer_plugin.export.sdf.generic.sdf_tree.SDFTree.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints the kinematic tree to the command line (for debugging).</span>
<span class="sd">        This function serves as an example for export export.</span>
<span class="sd">        :param depth: the depth of the kinematics sub tree for indention</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">, link: </span><span class="si">%s</span><span class="s2">, joint: </span><span class="si">%s</span><span class="s2">, type: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="n">depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint</span><span class="o">.</span><span class="n">type_</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Root link: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></div></div>

<span class="c1"># debugging the module</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">robot</span> <span class="o">=</span> <span class="n">SDFTree</span><span class="p">()</span>
    <span class="n">robot</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;/home/gchen/Dropbox/project/HBP-RD/BlenderRobotDesigner/mouse_v2_model/model_wo_toproot.sdf&quot;</span><span class="p">)</span>
    <span class="n">robot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
            </div>

            <aside class="hbpdoc-hnav hbpdoc-hnav-bottom">
                
                
            </aside>
        </article>
    </section>


    <div class="hbpdoc-footer">
        NRP RobotDesigner <small>0.1</small> 
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, Stefan Ulbrich (FZI).
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.2.
    </div>
    </div>
</div>

  </body>
</html>