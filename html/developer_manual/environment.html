


<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Developing the RobotDesigner &#8212; NRP RobotDesigner 0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/hbpdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/hbpdoc.js"></script>
    <link rel="shortcut icon" href="../_static/hbp_32x32.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The Plugin Core" href="plugin_core.html" />
    <link rel="prev" title="Developers Manual" href="index.html" />
<meta name="viewport" content="width=device-width, initial-scale=1">

  </head>
  <body>
<div class="hbpdoc-page">
    <section class="hbpdoc-title page-header">
        <a class="project-title" href="../index.html">NRP RobotDesigner</a>

        <a class="hbpdoc-toc-toggle pull-right" href>
            <span class="zmdi zmdi-menu"></span> <span class="sr-only icon-text">Menu</span>
        </a>
    </section>
    <section class="hbpdoc-main">
        <nav class="hbpdoc-sidebar hbpdoc-container">
            <a class="hbpdoc-toc-toggle pull-right" href>
                <span class="zmdi zmdi-menu"></span> <span class="sr-only icon-text">Menu</span>
            </a>
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Developing the RobotDesigner</a><ul>
<li><a class="reference internal" href="#setting-up-the-development-environment">Setting up the development environment</a></li>
<li><a class="reference internal" href="#editing-with-pycharm-tm">Editing with PyCharm (TM)</a></li>
<li><a class="reference internal" href="#editing-with-atom">Editing with Atom</a></li>
<li><a class="reference internal" href="#geometric-operations-in-blender">Geometric operations in Blender</a><ul>
<li><a class="reference internal" href="#pose-of-segment-in-world-coordinates"><code class="docutils literal"><span class="pre">Pose</span></code> of segment in <code class="docutils literal"><span class="pre">world</span> <span class="pre">coordinates</span></code></a></li>
<li><a class="reference internal" href="#relative-pose-to-segment">Relative <code class="docutils literal"><span class="pre">pose</span></code> to segment</a></li>
<li><a class="reference internal" href="#bezier-curves">Bezier curves</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Developers Manual</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="plugin_core.html"
                        title="next chapter">The Plugin Core</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/developer_manual/environment.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
        </nav>

        <article class="hbpdoc-content">

            <div class="content">
                
                <div class="breadcrumb breadcrumb-meta expand">
                    
                    <a href="index.html">Developers Manual</a>
                    
                </div>
                

                <aside class="hbpdoc-hnav hbpdoc-hnav-top">
                    
                    <span class="hbpdoc-hnav-previous">
                        previous: <a class="hbpdoc-hnav-link" href="index.html">Developers Manual</a>
                    </span>
                    
                    
                    <span class="hbpdoc-hnav-next">
                        next: <a class="hbpdoc-hnav-link" href="plugin_core.html">The Plugin Core</a>
                    </span>
                    
                </aside>

                <div class="section" id="developing-the-robotdesigner">
<h1>Developing the RobotDesigner<a class="headerlink" href="#developing-the-robotdesigner" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setting-up-the-development-environment">
<h2>Setting up the development environment<a class="headerlink" href="#setting-up-the-development-environment" title="Permalink to this headline">¶</a></h2>
<p>This section describes how to setup an environment for developing the RobotDesigner including a description of
the suggested tools.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section assumes that you use either <a class="reference external" href="http://www.ubuntu.com/">Ubuntu Linux</a> or Mac OS X.</p>
</div>
</div></blockquote>
<p>The RobotDesigner (and Blender Plugins in general) are written in
<a class="reference external" href="https://en.wikipedia.org/wiki/Python_(programming_language)">Python</a>.  Therefore, you will at first require
a python installation. On Linux, you have to write the following commands in a terminal:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo apt-get install python3, python3-pip
<span class="gp">$</span> pip3 install virtualenv
</pre></div>
</div>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Pip_(package_manager)">Pip</a> is a package manager for Python and
<a class="reference external" href="https://virtualenv.readthedocs.org/en/latest/">virtualenv</a> creates a <em>virtual</em> environment where
you can install additional Python Packages and tools while only affecting your project.</p>
<p>On MacOS it is suggested to install python via <a class="reference external" href="http://brew.sh/">homebrew</a>. After its installation, run the
following commands:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">user@hbp $</span> brew install python3
<span class="gp">user@hbp $</span> pip3 install virtualenv
</pre></div>
</div>
<p>Now you need to download the RobotDesigner repository and to setup a virtual environment within its folder.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">user@hbp ~$</span> <span class="nb">cd</span> projects
<span class="gp">user@hbp ~/projects $</span> git clone ...
<span class="gp">user@hbp ~/projects$</span> <span class="nb">cd</span> RobotDesigner/
<span class="gp">user@hbp ~/projects/RobotDesigner$</span> virtualenv -p /usr/local/bin/python3.4 venv
<span class="gp">user@hbp ~/projects/RobotDesigner$</span> <span class="nb">source</span> venv/bin/activate
<span class="gp">(venv)user@hbp ~/projects/RobotDesigner$</span> pip install -r robot_designer_plugin/requirements.txt
<span class="gp">(venv)user@hbp ~/projects/RobotDesigner $</span> deactivate
<span class="gp">user@hbp RobotDesigner $</span>
</pre></div>
</div>
<p>In order to work on the RobotDesigner, you need an
<a class="reference external" href="https://en.wikipedia.org/wiki/Integrated_development_environment">IDE</a> (or text editor). Modern IDEs provide you
with features such as <a class="reference external" href="https://en.wikipedia.org/wiki/Autocomplete#In_source_code_editors">code completion</a>, and
automated <a class="reference external" href="https://en.wikipedia.org/wiki/Code_refactoring">refactoring</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/Syntax_highlighting">syntax highlighting</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/Static_program_analysis">static code analysis</a>,
<a class="reference external" href="https://en.wikipedia.org/wiki/Git_(software)">version control (e.g., GIT)</a> and  much more.</p>
<p>The suggested IDE is the <a class="reference external" href="https://www.jetbrains.com/pycharm/download/">community edition of Pycharm</a> which is free
to used in open source projects. A good alternative is the <a class="reference external" href="https://atom.io/">Atom editor</a> which can be configured
for the work with Python projects.</p>
</div>
<div class="section" id="editing-with-pycharm-tm">
<h2>Editing with PyCharm (TM)<a class="headerlink" href="#editing-with-pycharm-tm" title="Permalink to this headline">¶</a></h2>
<div class="sidebar">
<p class="first sidebar-title"><a class="reference external" href="https://www.jetbrains.com/pycharm">Pycharm</a></p>
<a class="last reference internal image-reference" href="developer_manual/images/pycharm.svg"><div align="center" class="align-center"><img alt="developer_manual/images/pycharm.svg" src="developer_manual/images/pycharm.svg" width="200px" /></div>
</a>
</div>
<p>Main text</p>
<div class="figure align-center" id="id3">
<a class="reference internal image-reference" href="../_images/interpreter.png"><img alt="../_images/interpreter.png" src="../_images/interpreter.png" style="width: 384.0px; height: 235.0px;" /></a>
<p class="caption"><span class="caption-text">Setup for Pycharm with a virtual env (click to enlarge).</span></p>
</div>
</div>
<div class="section" id="editing-with-atom">
<h2>Editing with Atom<a class="headerlink" href="#editing-with-atom" title="Permalink to this headline">¶</a></h2>
<div class="sidebar">
<p class="first sidebar-title"><a class="reference external" href="https://atom.io">Atom.io</a></p>
<a class="last reference internal image-reference" href="developer_manual/images/atom.png"><img alt="developer_manual/images/atom.png" class="align-center" src="developer_manual/images/atom.png" style="width: 200px;" /></a>
</div>
<p>This editor is an interesting alternative for developing Python projects. According to its web page
it is</p>
<blockquote>
<div>A hackable text editor for the 21st Century</div></blockquote>
<p>in the <code class="docutils literal"><span class="pre">resources/templates</span></code> folder of the RobotDesigner repository there are templates for setting up the
development environment. First, download and install the editor (from the homepage or a package manager).
Open the editor and add the RobotDesigner project (<code class="docutils literal"><span class="pre">File-&gt;Add</span> <span class="pre">Project</span> <span class="pre">Folder</span></code>).</p>
<p>Then close the editor and run the following commands to install the proposed setup:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">user@hbp ~$</span> <span class="nb">cd</span> projects/RobotDesigner
<span class="gp">user@hbp ~/projects/RobotDesigner$</span> <span class="nb">cd</span> resources/templates
<span class="gp">user@hbp ~/projects/RobotDesigner/resources/templates$</span> apm install --packages-file package-list.txt
<span class="gp">user@hbp ~/projects/RobotDesigner/resources/templates$</span> pip3 --install atom-requirements.txt
<span class="gp">user@hbp ~/projects/RobotDesigner/resources/templates$</span> cat projects.cson &gt;&gt; ~/.atom/projects.cson
</pre></div>
</div>
<p>This gives you a basic configuration for the editor.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>This section is currently under development. For more information, please refer to the documentation of the
individual packages:</p>
<ul class="last simple">
<li><a class="reference external" href="https://atom.io/packages/atom-beautify">atom-beautify</a></li>
<li><a class="reference external" href="https://atom.io/packages/autocomplete-python">autocomplete-python</a></li>
<li><a class="reference external" href="https://atom.io/packages/hyperclick">hyperclick</a></li>
<li><a class="reference external" href="https://atom.io/packages/language-restructuredtext">language-restructuredtext</a></li>
<li><a class="reference external" href="https://atom.io/packages/linter">linter</a></li>
<li><a class="reference external" href="https://atom.io/packages/linter-flake8">linter-flake8</a></li>
<li><a class="reference external" href="https://atom.io/packages/open-recent">open-recent</a></li>
<li><a class="reference external" href="https://atom.io/packages/project-manager">project-manager</a></li>
</ul>
</div>
</div>
<div class="section" id="geometric-operations-in-blender">
<h2>Geometric operations in Blender<a class="headerlink" href="#geometric-operations-in-blender" title="Permalink to this headline">¶</a></h2>
<p>If executed in a text editor in Blender, add these lines first:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bpy</span>

<span class="n">C</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">scnd</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">selected_objects</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span><span class="s1">&#39;MESH&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">active_object</span>
</pre></div>
</div>
<p>Together with <a class="reference internal" href="glossary.html#term-condition"><span class="xref std std-term">condition</span></a> <code class="xref py py-class docutils literal"><span class="pre">robot_designer_plugin.operators.helpers.ModelSelected</span></code>.</p>
<div class="section" id="pose-of-segment-in-world-coordinates">
<h3><span class="xref std std-term">Pose</span> of segment in <span class="xref std std-term">world coordinates</span><a class="headerlink" href="#pose-of-segment-in-world-coordinates" title="Permalink to this headline">¶</a></h3>
<p>For example, Place an object (second) at the coordinate frame of the segment.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">pose_bone</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">active_object</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">bones</span><span class="p">[</span><span class="n">C</span><span class="o">.</span><span class="n">active_bone</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
<span class="n">global_pose</span> <span class="o">=</span>  <span class="n">model</span><span class="o">.</span><span class="n">matrix_world</span> <span class="o">*</span> <span class="n">pose_bone</span><span class="o">.</span><span class="n">matrix</span>
<span class="n">scnd</span><span class="o">.</span><span class="n">matrix_world</span> <span class="o">=</span> <span class="n">global_pose</span>
</pre></div>
</div>
</div>
<div class="section" id="relative-pose-to-segment">
<h3>Relative <span class="xref std std-term">pose</span> to segment<a class="headerlink" href="#relative-pose-to-segment" title="Permalink to this headline">¶</a></h3>
<p>Retrieve the relative posiion of an object to a segment:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">pose_bone</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">active_object</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">bones</span><span class="p">[</span><span class="n">C</span><span class="o">.</span><span class="n">active_bone</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
<span class="n">relative_pose</span> <span class="o">=</span> <span class="n">pose_bone</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">matrix_world</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span> <span class="o">*</span> <span class="n">scnd</span><span class="o">.</span><span class="n">matrix_world</span>
</pre></div>
</div>
</div>
<div class="section" id="bezier-curves">
<h3>Bezier curves<a class="headerlink" href="#bezier-curves" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>import bpy
from mathutils import Vector, Matrix</p>
<p>C = bpy.context
D = bpy.data</p>
<p>model = C.active_object
pose_bone = C.active_object.pose.bones[C.active_bone.name]
parent_bone = C.active_object.pose.bones[C.active_bone.parent.name]</p>
<p>parent_frame = model.matrix_world * parent_bone.matrix
parent_to_bone = parent_frame.inverted() * bezier.matrix_world</p>
<p>bone_to_parent = bezier.matrix_world.inverted() * parent_frame</p>
<p>l = bone_to_parent.translation.length</p>
<p>bevel= bpy.ops.curve.primitive_bezier_circle_add(radius=l/0.25)
bezier=bpy.ops.curve.primitive_bezier_curve_add()</p>
<p>bezier.bevel_object = bevel</p>
<p>bezier.matrix_world =  model.matrix_world * pose_bone.matrix</p>
<p>print(bezier.matrix_world)
#e= C.active_bone.RobotEditor.Euler</p>
<p>bpy.ops.object.mode_set(mode=”EDIT”,toggle=False)</p>
<p>a=bezier.data.splines[0].bezier_points[0]
b=bezier.data.splines[0].bezier_points[1]</p>
<p>a.co = (0,0,0)
b.co = bone_to_parent.translation</p>
<p>v1 = bone_to_parent.translation</p>
<p>max_v1 = max ( abs(i) for i in v1)
print(v1,max_v1)
v1 = [ 0.1*i/max_v1 if abs(i)==max_v1 else 0.0 for i in v1]</p>
<p>v2 = parent_to_bone.translation
max_v2 = max ( abs(i) for i in v2)
v2 = [ 0.1*i/max_v2 if abs(i)==max_v2 else 0.0 for i in v2]
#v2 = Vector(v2)#.to_4d()
#v2[3]=0.0</p>
<p>a.handle_right=v1
#a.handle_left=-1 * a.handle_right
print(v1,a.handle_right,a.handle_left)</p>
<p>m=Matrix()
m.translation = v2
#m[3][3] = 0
#b.co = (bone_to_parent <a href="#id1"><span class="problematic" id="id2">*</span></a>m).translation
print(m, bone_to_parent.inverted() * parent_frame * m)
b.handle_left=(bone_to_parent * m).translation
#b.handle_left=-1 * b.handle_right
print(v2,b.handle_right,b.handle_left)</p>
<p>#print(a.co,b.co)</p>
<p>bpy.ops.object.mode_set(mode=”OBJECT”,toggle=False)</p>
</div>
</div>
</div>

            </div>

            <aside class="hbpdoc-hnav hbpdoc-hnav-bottom">
                
                <span class="hbpdoc-hnav-previous">
                    previous: <a class="hbpdoc-hnav-link" href="index.html">Developers Manual</a>
                </span>
                
                
                <span class="hbpdoc-hnav-next">
                    next: <a class="hbpdoc-hnav-link" href="plugin_core.html">The Plugin Core</a>
                </span>
                
            </aside>
        </article>
    </section>


    <div class="hbpdoc-footer">
        NRP RobotDesigner <small>0.1</small> 
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, Stefan Ulbrich (FZI).
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.2.
    </div>
    </div>
</div>

  </body>
</html>